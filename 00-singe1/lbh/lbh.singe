--[[

PROGRAM NAME:	LAST BOUNTY HUNTER (SINGE EDITION)
AUTHOR:			RDG2010

This file is part of LAST BOUNTY HUNTER (SINGE EDITION)

    LAST BOUNTY HUNTER (SINGE EDITION) is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation.

    LAST BOUNTY HUNTER (SINGE EDITION) is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.

    Read COPYING.TXT for more info.


]]--


sVersion = "1.0b"
sType = "CDROM"

dofile("singe/lbh/cdrom-globals.singe")
dofile("singe/lbh/cdrom-setuplevel.singe")
dofile("singe/lbh/hscore.singe")
dofile("singe/lbh/manage.singe")
dofile("singe/lbh/service.singe")
dofile("singe/lbh/toolbox.singe")
dofile("singe/lbh/cdrom-hitbox-armybase.singe")
dofile("singe/lbh/cdrom-hitbox-cactus1.singe")
dofile("singe/lbh/cdrom-hitbox-cactus2.singe")
dofile("singe/lbh/cdrom-hitbox-dan1.singe")
dofile("singe/lbh/cdrom-hitbox-dan2.singe")
dofile("singe/lbh/cdrom-hitbox-final.singe")
dofile("singe/lbh/cdrom-hitbox-harry1.singe")
dofile("singe/lbh/cdrom-hitbox-harry2.singe")
dofile("singe/lbh/cdrom-hitbox-harry3.singe")
dofile("singe/lbh/cdrom-hitbox-loco1.singe")
dofile("singe/lbh/cdrom-hitbox-loco2.singe")
dofile("singe/lbh/cdrom-hitbox-loco3.singe")
dofile("singe/lbh/cdrom-hitbox-showdows.singe")
dofile("singe/lbh/hitbox-bonus.singe")
dofile("singe/lbh/hitmap-poster.singe")

function bonusHit(thisFrame)

	local k = 0
	local f1 = 0
	local f2 = 0
	local x1 = 0
	local x2 = 0
	local y1 = 0
	local y2 = 0
	local bResult = false
	local bFound = false
	
	bResult = false
	
	for k=1,hitmapTotal do
		
		if (hitmap[k][hitmapFrame] == thisFrame) then	
			
			f1 = hitmap[k][hitboxBonus]	
			if f1 > 0 then bFound = true end
			
		elseif (hitmap[k][hitmapFrame] > thisFrame) then		
			
			break
			
		end	

	end
	
	if bFound == true then
		
		x1 = powerup[f1][bbx1]
		y1 = powerup[f1][bby1]
		x2 = powerup[f1][bbx2]
		y2 = powerup[f1][bby2]
		
		if (mousex >= x1 and mousex <= x2) and (mousey >= y1 and mousey <= y2) then	-- Player hit!
		
			if bDebug then debugPrint ("BONUS SHOT!") end
			
			bResult = true				
		end
		
	end

	return bResult

end

function civillianHit(thisFrame)

	local k = 0
	local f1 = 0
	local f2 = 0
	local x1 = 0
	local x2 = 0
	local y1 = 0
	local y2 = 0
	local bResult = false
	local bFound = false
	
	bResult = false
	
	for k=1,hitmapTotal do
		
		if (hitmap[k][hitmapFrame] == thisFrame) then	
			
			f1 = hitmap[k][hitmapCivStart]
			f2 = f1 + (hitmap[k][hitmapCivCount]-1)
			
			bFound = true 
			break
		end	

	end
	
	if bFound == true then

		for k=f1,f2 do
			
			x1 = civillian[k][bbx1]
			y1 = civillian[k][bby1]
			x2 = civillian[k][bbx2]
			y2 = civillian[k][bby2]
			
			if (mousex >= x1 and mousex <= x2) and (mousey >= y1 and mousey <= y2) then	-- Player hit!
			
				if bDebug then debugPrint ("PLAYER KILLED A CIVILLIAN!") end
				bResult = true
				break
			
			end
			
		end
		
	end
	
	return bResult

end

function panelHit(thisObject)
	
	local k = 0
	local x1 = 0
	local x2 = 0
	local yy = 0
	local arrayMax = 0
	local bResult = false
	local bFound = true
	
	bResult = false
	
	if thisObject == STAGE_HARRY then
	
		arrayMax = 78
		
	elseif thisObject == STAGE_DAN then
	
		arrayMax = 77
		
	else
	
		arrayMax = 82
		
	end
	
	if bFound then
		
		for k=1, arrayMax do
			
			x1 = area[thisObject][k][lineStartX]
			x2 = area[thisObject][k][lineEndX]
			yy = area[thisObject][k][lineY]
			
			if (mousey == yy) then
			
				if (mousex >= x1 and mousex <= x2) then
					
					if bDebug then debugPrint("PANEL HIT!") end
					bResult = true
					break
				end
			
			end		
		
		end
		
	end
	
	return bResult


end

function shooterHit(thisFrame, thisMove)
	
	local k = 0
	local f1 = 0
	local f2 = 0
	local x1 = 0
	local x2 = 0
	local y1 = 0
	local y2 = 0	
	local bResult = false
	local bFound = false
	local loopStart = move[thisMove][hitboxStart]
	local loopEnd = move[thisMove][hitboxEnd]
	
	bResult = false
	
	for k=loopStart,loopEnd do
		
		if (hitmap[k][hitmapFrame] == thisFrame) then
			
			f1 = hitmap[k][hitmapIndex]
			f2 = f1 + (hitmap[k][hitmapCount]-1)
			bFound = true		
			
			break
		end	

	end
	
	if bFound then
		
		for k=f1,f2 do
			
			x1 = hitbox[k][bbx1]
			y1 = hitbox[k][bby1]
			x2 = hitbox[k][bbx2]
			y2 = hitbox[k][bby2]
			
			if (mousex >= x1 and mousex <= x2) and (mousey >= y1 and mousey <= y2) then	-- Player hit!
				
				if k == f1 then
				
					if not (f1 == f2) then
				
						iScore = iScore + (SCORE_BADGUY * 0.25)						
						
					end
				
				end
				
				if bDebug then debugPrint ("BAD GUY HIT!") end
				bResult = true
				break
			
			end
			
		end
		
	end

	return bResult

end

function doLevelArmybase()

	if (lvlState == lvlSetup) then
	
		if bDebug then debugPrint ("Entering doLevelArmybase()") end
	
		setupLevel(levelArmybase)
		levelFrameStart = thisOffset
		levelFrameEnd   = thisOffset + 1873
		bLevelComplete  = false		
		currentMove = 1		
		
		discSkipToFrame(levelFrameStart)
		lvlState = lvlRunning
		
	elseif (lvlState == lvlPlayClip1) then
	
		if (currentFrame == thisOffset + 1360) then
		
			lvlState = lvlRunning
		
		else
		
			drawHStable()
			
		end
		
	elseif (lvlState == lvlPause) then
	
		if timerDue() then
		
			discSkipToFrame(move[currentMove][deathFrameStart])				
			lvlState = lvlPlayDeath			
			
		else
		
			if (p1BUTTON3) then
				p1BUTTON3 = false
				if (iBullets > 0) then
				
					if (shooterHit(currentFrame - thisOffset, currentMove) == true) then -- Bad guy Hit!
						
						iScore = iScore + SCORE_BADGUY
						discSkipToFrame(move[currentMove][moveFrameEnd]+1)
						currentMove = currentMove + 1
						lvlState = lvlRunning
						
					elseif (civillianHit(currentFrame - thisOffset) == true) then						
					
						discSkipToFrame(move[currentMove][deathFrameStart])				
						lvlState = lvlPlayDeath					
					
					end				
					
				end
				
			end
		
		end
	
	elseif (lvlState == lvlRunning) then
	
		if (currentMove > totalMoves) then
		
			if (currentFrame == levelFrameEnd) then
			
				bLevelComplete = true
				lvlState = lvlEnd
				
			elseif (currentFrame == thisOffset + 1256) then
		
				lvlState = lvlPlayClip1
				
			end
			
		elseif (currentFrame > move[currentMove][moveFrameEnd]) then -- Death to player!
		
			if (move[currentMove][rndMoveType] == GOODGUY) then
			
				currentMove = currentMove + 1
			else
			
				discSkipToFrame(move[currentMove][moveFrameEnd])
				discPause()			
				timerON(iDelay)
				lvlState = lvlPause			
				
			end
		
		elseif (currentFrame >= move[currentMove][moveFrameStart] and currentFrame < move[currentMove][moveFrameEnd]) then
		
			if (p1BUTTON3) then
				p1BUTTON3 = false
				if (iBullets > 0) then
				
					if (shooterHit(currentFrame - thisOffset, currentMove) == true) then -- Bad guy Hit!
					
						iScore = iScore + SCORE_BADGUY
						discSkipToFrame(move[currentMove][moveFrameEnd]+1)
						currentMove = currentMove + 1
						
					elseif (civillianHit(currentFrame - thisOffset) == true) then						
					
						discSkipToFrame(move[currentMove][deathFrameStart])				
						lvlState = lvlPlayDeath					
					
					end
				
				end				
				
			end
			
		end
		
	elseif (lvlState == lvlPlayDeath) then
	
		if (currentFrame == move[currentMove][deathFrameEnd]) then
		
			if (move[currentMove][rndMoveType] == GOODGUY) then
			
				lvlState = lvlEnd				
				
			else
			
				getNags(NAG_NORMAL)
				discSkipToFrame(nagFrameStart)
				lvlState = lvlPlayNag			
				
			end
		
		end
		
	elseif (lvlState == lvlPlayNag) then
	
		if (currentFrame == nagFrameEnd or p1BUTTON3) then
		
			p1BUTTON3 = false		
			lvlState = lvlEnd
		
		end	
	
	elseif (lvlState == lvlEnd) then
	
		lvlState = lvlSetup
		if (iLives == 0) then --Game Over 
			
			tempLevel = currentLevel		
			currentLevel = levelContinue
			
		elseif (iLives > 0 and dip_Undertaker == false and not bLevelComplete) then
			
			tempLevel = currentLevel
			currentLevel = levelLivesLeft			
			
		else
			
			if bLevelComplete then			
				
				stage[levelArmybase] = true				
				currentLevel = levelMenu				
				
			end			
			

		end

		if bDebug then debugPrint ("Leaving doLevelArmybase()") end
	
	end

end

function doLevelBonus()

	if (lvlState == lvlSetup) then
	
		if bDebug then debugPrint ("Entering doLevelBonus()") end
	
		setupLevel(levelBonus)
		levelFrameStart = thisOffset
		levelFrameEnd   = thisOffset + 810
		bLevelComplete  = false		
		bNoMoreBonuses  = false
		bShowScore = true		
		bReloadDisabled = false
		
		currentMove = 1	
		
		if bSection01Reached then
		
			lvlState = lvlRunning
			discSkipToFrame(move[currentMove][rndMoveStart])
			
		else
		
			lvlState = lvlPlayClip3
			discSkipToFrame(thisOffset + 1110)
			
		end		
		
	elseif (lvlState == lvlPlayClip3) then
	
		if currentFrame == thisOffset + 1218 then
		
			discSkipToFrame(move[currentMove][rndMoveStart])
			bSection01Reached = true
			lvlState = lvlRunning
		
		end
		
	elseif (lvlState == lvlPlayClip1) then
	
		if currentFrame == levelFrameEnd then
		
			bLevelComplete = true			
			lvlState = lvlEnd
		
		end		
		
	elseif (lvlState == lvlPlayClip2) then
	
		if (currentFrame == move[currentMove][rndMoveEnd]) then
			
			currentMove = currentMove + 1
			
			if (currentMove <= totalMoves) then
				
				discSkipToFrame(move[currentMove][rndMoveStart])
			
			end
			
			lvlState = lvlRunning
			
		elseif (p1BUTTON3) then
			p1BUTTON3 = false
			if (iBullets > 0) then
			
				if bNoMoreBonuses == false then
				
					local b1 = false
				
					if (currentFrame >= thisOffset + 15) and (currentFrame <= thisOffset + 799) then
					
						if (mousex >= 97 and mousex <= 111 and mousey >= 151 and mousey <= 175) then
						
							b1 = true
						
						end					
						
					elseif bonusHit(currentFrame - thisOffset) then
					
						b1 = true
						
					end
					
					if b1 then 
					
						iBullets = 13
						bNoMoreBonuses = true
						playMe(sndBonus)
						
					end
					
				end
			
			end
		
		end
	
		
	elseif (lvlState == lvlPause) then
	
		if timerDue() then
		
			discSkipToFrame(move[currentMove][deathFrameStart])				
			lvlState = lvlPlayDeath			
			
		else
		
			if (p1BUTTON3) then
				p1BUTTON3 = false
				if (iBullets > 0) then
				
					if (shooterHit(currentFrame - thisOffset, currentMove) == true) then -- Bad guy Hit!
						
						iScore = iScore + SCORE_BADGUY
						discSkipToFrame(move[currentMove][moveFrameEnd]+1)
						lvlState = lvlPlayClip2
					
					end	
					
				end
				
			end
		
		end
	
	elseif (lvlState == lvlRunning) then
	
		if (currentMove > totalMoves) then
		
			discSkipToFrame(thisOffset + 800)
			lvlState = lvlPlayClip1
	
		elseif (currentFrame > move[currentMove][moveFrameEnd]) then -- Death to player!
		
			if (move[currentMove][rndMoveType] == GOODGUY) then
			
				lvlState = lvlPlayClip2
				
			else
			
				discSkipToFrame(move[currentMove][moveFrameEnd])
				discPause()			
				timerON(iDelay)
				lvlState = lvlPause			
				
			end
		
		elseif (currentFrame >= move[currentMove][moveFrameStart] and currentFrame < move[currentMove][moveFrameEnd]) then
		
			if (p1BUTTON3) then
				p1BUTTON3 = false
				if (iBullets > 0) then
				
					if (shooterHit(currentFrame - thisOffset, currentMove) == true) then -- Bad guy Hit!
					
						iScore = iScore + SCORE_BADGUY
						discSkipToFrame(move[currentMove][moveFrameEnd]+1)		
						
						lvlState = lvlPlayClip2
						
					elseif (civillianHit(currentFrame - thisOffset) == true) then						
					
						discSkipToFrame(move[currentMove][deathFrameStart])				
						lvlState = lvlPlayDeath
					
					elseif bNoMoreBonuses == false then
					
						local b1 = false
				
						if (currentFrame >= thisOffset + 15) and (currentFrame <= thisOffset + 799) then
					
							if mousex >= 97 and mousex <= 111 and mousey >= 151 and mousey <= 175 then
							
								b1 = true
							
							end					
							
						elseif bonusHit(currentFrame - thisOffset) then
						
							b1 = true
							
						end
						
						if b1 then 
						
							iBullets = 13
							bNoMoreBonuses = true
							playMe(sndBonus)
							
						end
					
					end
				
				end				
				
			end
			
		else
		
			if (p1BUTTON3) then
		
				if bNoMoreBonuses == false then
					
					if (currentFrame >= thisOffset + 15) and (currentFrame <= thisOffset + 799) then
					
						if mousex >= 97 and mousex <= 111 and mousey >= 151 and mousey <= 175 then
					
							iBullets = 13
							bNoMoreBonuses = true
							playMe(sndBonus)
							
						end
					
					end
					
				end
				
			end
			
		end
		
	elseif (lvlState == lvlPlayDeath) then
	
		if (currentFrame == move[currentMove][deathFrameEnd]) then
		
			if (move[currentMove][rndMoveType] == GOODGUY) then
			
				getNags(NAG_FRIENDLYKILLED)
				
			else
			
				getNags(NAG_NORMAL)
				
			end
			discSkipToFrame(nagFrameStart)
			lvlState = lvlPlayNag			
				
		
		end
		
	elseif (lvlState == lvlPlayNag) then
	
		if (currentFrame == nagFrameEnd or p1BUTTON3) then
		
			p1BUTTON3 = false		
			lvlState = lvlEnd
		
		end	
	
	elseif (lvlState == lvlEnd) then
	
		lvlState = lvlSetup		
		if (iLives == 0) then --Game Over 
			
			tempLevel = currentLevel		
			currentLevel = levelContinue
			
		elseif (iLives > 0 and dip_Undertaker == false and not bLevelComplete) then
			
			tempLevel = currentLevel
			currentLevel = levelLivesLeft			
			
		else
			
			if bLevelComplete == true then			
				
				stage[levelBonus] = true				
				bSection01Reached = false
			
			end				
			currentLevel = levelMenu

		end

		if bDebug then debugPrint ("Leaving doLevelBonus()") end
	
	end

end

function doLevelCactus1()

	if (lvlState == lvlSetup) then
	
		if bDebug then debugPrint ("Entering doLevelCactus1()") end
	
		setupLevel(levelCactus1)
		levelFrameStart = thisOffset
		levelFrameEnd   = thisOffset + 508
		bLevelComplete  = false		
		bNoMoreBonuses  = false
		
		currentMove = 1				
		setupClip(offsetMenus + 3680, offsetMenus + 3761)
		lvlState = lvlPlayClip1
		
	elseif (lvlState == lvlPlayClip1) then
	
		if (currentFrame == iFrameEnd) then
		
			discSkipToFrame(levelFrameStart)		
			lvlState = lvlRunning
		
		end
		
	elseif (lvlState == lvlPause) then
	
		if timerDue() then
		
			discSkipToFrame(move[currentMove][deathFrameStart])				
			lvlState = lvlPlayDeath			
			
		else
		
			if (p1BUTTON3) then
				p1BUTTON3 = false
				if (iBullets > 0) then
				
					if (shooterHit(currentFrame - thisOffset, currentMove) == true) then -- Bad guy Hit!
						
						iScore = iScore + SCORE_BADGUY
						discSkipToFrame(move[currentMove][moveFrameEnd]+1)
						currentMove = currentMove + 1
						lvlState = lvlRunning
						
					elseif (civillianHit(currentFrame - thisOffset) == true) then						
				
						discSkipToFrame(move[currentMove][deathFrameStart])				
						lvlState = lvlPlayDeath
					

					elseif bNoMoreBonuses == false then
					
						local b1 = false
				
						if (currentFrame >= thisOffset + 10) and (currentFrame <= thisOffset + 370) then
					
							if mousex >= 85 and mousex <= 91 and mousey >= 133 and mousey <= 145 then
							
								b1 = true
								
							end
							
						elseif bonusHit(currentFrame - thisOffset) then
						
							b1 = true
							
						end
						
						if b1 then 
						
							iBullets = 13
							bNoMoreBonuses = true
							playMe(sndBonus)
							
						end	
					
					end	
					
				end
				
			end
		
		end
	
	elseif (lvlState == lvlRunning) then
	
		if (currentMove > totalMoves) then
		
			if (currentFrame == levelFrameEnd) then
	
				bLevelComplete = true				
				lvlState = lvlEnd
				
			end
			
		elseif (currentFrame > move[currentMove][moveFrameEnd]) then -- Death to player!
		
			if (move[currentMove][rndMoveType] == GOODGUY) then
			
				currentMove = currentMove + 1
			else
			
				discSkipToFrame(move[currentMove][moveFrameEnd])
				discPause()			
				timerON(iDelay)
				lvlState = lvlPause			
				
			end
		
		elseif (currentFrame >= move[currentMove][moveFrameStart] and currentFrame < move[currentMove][moveFrameEnd]) then
		
			if (p1BUTTON3) then
				p1BUTTON3 = false
				if (iBullets > 0) then
				
					if (shooterHit(currentFrame - thisOffset, currentMove) == true) then -- Bad guy Hit!
					
						iScore = iScore + SCORE_BADGUY
						discSkipToFrame(move[currentMove][moveFrameEnd]+1)
						currentMove = currentMove + 1
						
					elseif (civillianHit(currentFrame - thisOffset) == true) then						
					
						discSkipToFrame(move[currentMove][deathFrameStart])				
						lvlState = lvlPlayDeath
					
					elseif bNoMoreBonuses == false then
					
						local b1 = false
				
						if (currentFrame >= thisOffset + 10) and (currentFrame <= thisOffset + 370) then
					
							if mousex >= 85 and mousex <= 91 and mousey >= 133 and mousey <= 145 then
							
								b1 = true
								
							end
							
						elseif bonusHit(currentFrame - thisOffset) then
						
							b1 = true
							
						end
						
						if b1 then 
						
							iBullets = 13
							bNoMoreBonuses = true
							playMe(sndBonus)
							
						end	
					
					end
				
				end				
				
			end
			
		else
		
			if (p1BUTTON3) then
				p1BUTTON3 = false
				if bNoMoreBonuses == false then
					
					local b1 = false
				
					if (currentFrame >= thisOffset + 10) and (currentFrame <= thisOffset + 370) then
				
						if mousex >= 85 and mousex <= 91 and mousey >= 133 and mousey <= 145 then
						
							b1 = true
							
						end
						
					elseif bonusHit(currentFrame - thisOffset) then
					
						b1 = true
						
					end
					
					if b1 then 
					
						iBullets = 13
						bNoMoreBonuses = true
						playMe(sndBonus)
						
					end	
					
				end
				
			end
			
		end
		
	elseif (lvlState == lvlPlayDeath) then
	
		if (currentFrame == move[currentMove][deathFrameEnd]) then
		
			if (move[currentMove][rndMoveType] == GOODGUY) then
			
				getNags(NAG_FRIENDLYKILLED)
				
			else
			
				getNags(NAG_NORMAL)
				
			end
			discSkipToFrame(nagFrameStart)
			lvlState = lvlPlayNag			
				
		
		end
		
	elseif (lvlState == lvlPlayNag) then
	
		if (currentFrame == nagFrameEnd or p1BUTTON3) then
		
			p1BUTTON3 = false		
			lvlState = lvlEnd
		
		end	
	
	elseif (lvlState == lvlEnd) then
	
		lvlState = lvlSetup
		if (iLives == 0) then --Game Over 
			
			tempLevel = currentLevel		
			currentLevel = levelContinue
			
		elseif (iLives > 0 and dip_Undertaker == false and not bLevelComplete) then
			
			tempLevel = currentLevel
			currentLevel = levelLivesLeft			
			
		else
			
			if bLevelComplete then			
				
				stage[levelCactus1] = true
				currentLevel = levelCactus2
				bSection01Reached = false
				bShowdown = true
				
			else
			
				currentLevel = levelMenu
				
			end			
			

		end

		if bDebug then debugPrint ("Leaving doLevelCactus1()") end
	
	end

end

function doLevelCactus2()

	if (lvlState == lvlSetup) then
	
		if bDebug then debugPrint ("Entering doLevelCactus2()") end
	
		setupLevel(levelCactus2)
		levelFrameStart = thisOffset + 509
		levelFrameEnd   = thisOffset + 1148
		bLevelComplete  = false		
		bNoMoreBonuses  = false
		
		currentMove = 1				
		discSkipToFrame(levelFrameStart)		
		lvlState = lvlRunning
		
	elseif (lvlState == lvlPause) then
	
		if timerDue() then
		
			discSkipToFrame(move[currentMove][deathFrameStart])				
			lvlState = lvlPlayDeath			
			
		else
		
			if (p1BUTTON3) then
				p1BUTTON3 = false
				if (iBullets > 0) then
				
					if (shooterHit(currentFrame - thisOffset, currentMove) == true) then -- Bad guy Hit!
						
						iScore = iScore + SCORE_BADGUY
						discSkipToFrame(move[currentMove][moveFrameEnd]+1)
						currentMove = currentMove + 1
						lvlState = lvlRunning
						
					elseif (civillianHit(currentFrame - thisOffset) == true) then						
				
						discSkipToFrame(move[currentMove][deathFrameStart])				
						lvlState = lvlPlayDeath
					

					elseif bNoMoreBonuses == false then
					
						if bonusHit(currentFrame - thisOffset) then
						
							iBullets = 13
							bNoMoreBonuses = true
							playMe(sndBonus)
						
						end
					
					end	
					
				end
				
			end
		
		end
	
	elseif (lvlState == lvlRunning) then
	
		if (currentMove > totalMoves) then
		
			if (currentFrame == levelFrameEnd) then
	
				bLevelComplete = true				
				lvlState = lvlEnd
				
			end
			
		elseif (currentFrame > move[currentMove][moveFrameEnd]) then -- Death to player!
		
			if (move[currentMove][rndMoveType] == GOODGUY) then
			
				currentMove = currentMove + 1
			else
			
				discSkipToFrame(move[currentMove][moveFrameEnd])
				discPause()			
				timerON(iDelay)
				lvlState = lvlPause			
				
			end
		
		elseif (currentFrame >= move[currentMove][moveFrameStart] and currentFrame < move[currentMove][moveFrameEnd]) then
		
			if (p1BUTTON3) then
				p1BUTTON3 = false
				if (iBullets > 0) then
				
					if (shooterHit(currentFrame - thisOffset, currentMove) == true) then -- Bad guy Hit!
					
						iScore = iScore + SCORE_BADGUY
						discSkipToFrame(move[currentMove][moveFrameEnd]+1)
						currentMove = currentMove + 1
						
					elseif (civillianHit(currentFrame - thisOffset) == true) then						
					
						discSkipToFrame(move[currentMove][deathFrameStart])				
						lvlState = lvlPlayDeath
					
					elseif bNoMoreBonuses == false then
					
						if bonusHit(currentFrame - thisOffset) then
						
							iBullets = 13
							bNoMoreBonuses = true
							playMe(sndBonus)
						
						end
					
					end
				
				end				
				
			end
			
		else
		
			if (p1BUTTON3) then
				p1BUTTON3 = false
				if bNoMoreBonuses == false then
					
					if bonusHit(currentFrame - thisOffset) then
					
						iBullets = 13
						bNoMoreBonuses = true
						playMe(sndBonus)
					
					end
					
				end
				
			end
			
		end
		
	elseif (lvlState == lvlPlayDeath) then
	
		if (currentFrame == move[currentMove][deathFrameEnd]) then
		
			if (move[currentMove][rndMoveType] == GOODGUY) then
			
				getNags(NAG_FRIENDLYKILLED)
				
			else
			
				getNags(NAG_NORMAL)
				
			end
			discSkipToFrame(nagFrameStart)
			lvlState = lvlPlayNag			
				
		
		end
		
	elseif (lvlState == lvlPlayNag) then
	
		if (currentFrame == nagFrameEnd or p1BUTTON3) then
		
			p1BUTTON3 = false		
			lvlState = lvlEnd
		
		end	
	
	elseif (lvlState == lvlEnd) then
	
		lvlState = lvlSetup
		if (iLives == 0) then --Game Over 
			
			tempLevel = currentLevel		
			currentLevel = levelContinue
			
		elseif (iLives > 0 and dip_Undertaker == false and not bLevelComplete) then
			
			tempLevel = currentLevel
			currentLevel = levelLivesLeft			
			
		else
			
			if bLevelComplete then			
				
				stage[levelCactus2] = true
				currentLevel = levelCactus3
				bSection01Reached = false				
				
			else
			
				currentLevel = levelMenu
				
			end			
			

		end

		if bDebug then debugPrint ("Leaving doLevelCactus2()") end
	
	end

end

function doLevelCactus3()

	if (lvlState == lvlSetup) then
	
		if bDebug then debugPrint ("Entering doLevelCactus3()") end
	
		setupLevel(levelCactus3)
		levelFrameStart = thisOffset + 1148
		levelFrameEnd   = thisOffset + 2416
		bLevelComplete  = false		
		bNoMoreBonuses  = false
		
		currentMove = 1				
		discSkipToFrame(levelFrameStart)		
		lvlState = lvlPlayClip1
		
	elseif (lvlState == lvlPlayClip1) then
	
		if currentFrame == thisOffset + 1300 then
		
			lvlState = lvlRunning
		
		elseif p1BUTTON3 then
		
			discSkipToFrame(thisOffset + 1300)
			lvlState = lvlRunning
		
		end
		
	elseif (lvlState == lvlPause) then
	
		if timerDue() then
		
			discSkipToFrame(move[currentMove][deathFrameStart])				
			lvlState = lvlPlayDeath			
			
		else
		
			if (p1BUTTON3) then
				p1BUTTON3 = false
				if (iBullets > 0) then
				
					if (shooterHit(currentFrame - thisOffset, currentMove) == true) then -- Bad guy Hit!
						
						iScore = iScore + SCORE_BADGUY
						discSkipToFrame(move[currentMove][moveFrameEnd]+1)
						currentMove = currentMove + 1
						lvlState = lvlRunning
						
					elseif (civillianHit(currentFrame - thisOffset) == true) then						
				
						if (currentMove == 3) then
						
							move[currentMove][deathFrameStart] = 8684
							move[currentMove][deathFrameEnd] = 8765
							move[currentMove][rndMoveType] = GOODGUY
						
						end
				
						discSkipToFrame(move[currentMove][deathFrameStart])				
						lvlState = lvlPlayDeath
					

					elseif bNoMoreBonuses == false then
					
						if bonusHit(currentFrame - thisOffset) then
						
							iBullets = 13
							bNoMoreBonuses = true
							playMe(sndBonus)
						
						end
					
					end	
					
				end
				
			end
		
		end
	
	elseif (lvlState == lvlRunning) then
	
		if (currentMove > totalMoves) then
		
			if (currentFrame == levelFrameEnd) then
	
				bLevelComplete = true				
				lvlState = lvlEnd
				
			end
			
		elseif (currentFrame > move[currentMove][moveFrameEnd]) then -- Death to player!
		
			if (move[currentMove][rndMoveType] == GOODGUY) then
			
				currentMove = currentMove + 1
			else
			
				discSkipToFrame(move[currentMove][moveFrameEnd])
				discPause()			
				timerON(iDelay)
				lvlState = lvlPause			
				
			end
		
		elseif (currentFrame >= move[currentMove][moveFrameStart] and currentFrame < move[currentMove][moveFrameEnd]) then
		
			if (p1BUTTON3) then
				p1BUTTON3 = false
				if (iBullets > 0) then
				
					if (shooterHit(currentFrame - thisOffset, currentMove) == true) then -- Bad guy Hit!
					
						iScore = iScore + SCORE_BADGUY
						discSkipToFrame(move[currentMove][moveFrameEnd]+1)
						currentMove = currentMove + 1
						
					elseif (civillianHit(currentFrame - thisOffset) == true) then						
					
						if (currentMove == 3) then
						
							move[currentMove][deathFrameStart] = 8684
							move[currentMove][deathFrameEnd] = 8765
							move[currentMove][rndMoveType] = GOODGUY
						
						end
					
						discSkipToFrame(move[currentMove][deathFrameStart])				
						lvlState = lvlPlayDeath
					
					elseif bNoMoreBonuses == false then
					
						local b1 = false
				
						if (currentFrame >= thisOffset + 1301) and (currentFrame <= thisOffset + 2410) then
					
							if mousex >= 296 and mousex <= 309 and mousey >= 46 and mousey <= 69 then
							
								b1 = true
								
							end
							
						elseif bonusHit(currentFrame - thisOffset) then
						
							b1 = true
							
						end
						
						if b1 then 
						
							iBullets = 13
							bNoMoreBonuses = true
							playMe(sndBonus)
							
						end	
					
					end
				
				end				
				
			end
			
		else
		
			if (p1BUTTON3) then
				p1BUTTON3 = false
				if bNoMoreBonuses == false then
					
					local b1 = false
				
					if (currentFrame >= thisOffset + 1301) and (currentFrame <= thisOffset + 2410) then
				
						if mousex >= 296 and mousex <= 309 and mousey >= 46 and mousey <= 69 then
						
							b1 = true
							
						end
						
					elseif bonusHit(currentFrame - thisOffset) then
					
						b1 = true
						
					end
					
					if b1 then 
					
						iBullets = 13
						bNoMoreBonuses = true
						playMe(sndBonus)
						
					end	
					
				end
				
			end
			
		end
		
	elseif (lvlState == lvlPlayDeath) then
	
		if (currentFrame == move[currentMove][deathFrameEnd]) then
		
			if (move[currentMove][rndMoveType] == GOODGUY) then
			
				getNags(NAG_FRIENDLYKILLED)
				
			else
			
				getNags(NAG_NORMAL)
				
			end
			discSkipToFrame(nagFrameStart)
			lvlState = lvlPlayNag			
				
		
		end
		
	elseif (lvlState == lvlPlayNag) then
	
		if (currentFrame == nagFrameEnd or p1BUTTON3) then
		
			p1BUTTON3 = false		
			lvlState = lvlEnd
		
		end	
	
	elseif (lvlState == lvlEnd) then
	
		lvlState = lvlSetup
		if (iLives == 0) then --Game Over 
			
			tempLevel = currentLevel		
			currentLevel = levelContinue
			
		elseif (iLives > 0 and dip_Undertaker == false and not bLevelComplete) then
			
			tempLevel = currentLevel
			currentLevel = levelLivesLeft			
			
		else
			
			if bLevelComplete then			
				
				stage[levelCactus3] = true
				currentLevel = levelCactus4
				bSection01Reached = false				
				
			else
			
				currentLevel = levelMenu
				
			end			
			

		end

		if bDebug then debugPrint ("Leaving doLevelCactus3()") end
	
	end

end

function doLevelCactus4()

	if (lvlState == lvlSetup) then
	
		if bDebug then debugPrint ("Entering doLevelCactus4()") end
	
		setupLevel(levelCactus4)
		levelFrameStart = thisOffset 
		levelFrameEnd   = thisOffset + 794
		bLevelComplete  = false		
		bNoMoreBonuses  = false
		
		currentMove = 1				
		discSkipToFrame(levelFrameStart)		
		lvlState = lvlPlayClip1
		
	elseif (lvlState == lvlPlayClip1) then
	
		if currentFrame == thisOffset + 138 then			
			
			lvlState = lvlRunning
		
		elseif (p1BUTTON3) then
		
			discSkipToFrame(thisOffset + 138)
			lvlState = lvlRunning		
		
		end
		
	elseif (lvlState == lvlPause) then
	
		if timerDue() then
		
			discSkipToFrame(move[currentMove][deathFrameStart])				
			lvlState = lvlPlayDeath			
			
		else
		
			if (p1BUTTON3) then
				p1BUTTON3 = false
				if (iBullets > 0) then
				
					if (shooterHit(currentFrame - thisOffset, currentMove) == true) then -- Bad guy Hit!
						
						iScore = iScore + SCORE_BADGUY
						discSkipToFrame(move[currentMove][moveFrameEnd]+1)
						currentMove = currentMove + 1
						lvlState = lvlRunning
						
					elseif (civillianHit(currentFrame - thisOffset) == true) then						
				
						discSkipToFrame(move[currentMove][deathFrameStart])				
						lvlState = lvlPlayDeath
					

					elseif bNoMoreBonuses == false then
					
						if bonusHit(currentFrame - thisOffset) then
						
							iBullets = 13
							bNoMoreBonuses = true
							playMe(sndBonus)
						
						end
					
					end	
					
				end
				
			end
		
		end
	
	elseif (lvlState == lvlRunning) then
	
		if (currentMove > totalMoves) then
		
			if (currentFrame == levelFrameEnd) then
	
				bLevelComplete = true				
				lvlState = lvlEnd
				
			end
			
		elseif (currentFrame > move[currentMove][moveFrameEnd]) then -- Death to player!
		
			if (move[currentMove][rndMoveType] == GOODGUY) then
			
				currentMove = currentMove + 1
			else
			
				discSkipToFrame(move[currentMove][moveFrameEnd])
				discPause()			
				timerON(iDelay)
				lvlState = lvlPause			
				
			end
		
		elseif (currentFrame >= move[currentMove][moveFrameStart] and currentFrame < move[currentMove][moveFrameEnd]) then
		
			if (p1BUTTON3) then
				p1BUTTON3 = false
				if (iBullets > 0) then
				
					if (shooterHit(currentFrame - thisOffset, currentMove) == true) then -- Bad guy Hit!
					
						iScore = iScore + SCORE_BADGUY
						discSkipToFrame(move[currentMove][moveFrameEnd]+1)
						currentMove = currentMove + 1
						
					elseif (civillianHit(currentFrame - thisOffset) == true) then						
					
						discSkipToFrame(move[currentMove][deathFrameStart])				
						lvlState = lvlPlayDeath
					
					elseif bNoMoreBonuses == false then
					
						if bonusHit(currentFrame - thisOffset) then
						
							iBullets = 13
							bNoMoreBonuses = true
							playMe(sndBonus)
						
						end
					
					end
				
				end				
				
			end
			
		else
		
			if (p1BUTTON3) then
				p1BUTTON3 = false
				if bNoMoreBonuses == false then
					
					if bonusHit(currentFrame - thisOffset) then
					
						iBullets = 13
						bNoMoreBonuses = true
						playMe(sndBonus)
					
					end
					
				end
				
			end
			
		end
		
	elseif (lvlState == lvlPlayDeath) then
	
		if (currentFrame == move[currentMove][deathFrameEnd]) then
		
			if (move[currentMove][rndMoveType] == GOODGUY) then
			
				getNags(NAG_FRIENDLYKILLED)
				
			else
			
				getNags(NAG_NORMAL)
				
			end
			discSkipToFrame(nagFrameStart)
			lvlState = lvlPlayNag			
				
		
		end
		
	elseif (lvlState == lvlPlayNag) then
	
		if (currentFrame == nagFrameEnd or p1BUTTON3) then
		
			p1BUTTON3 = false		
			lvlState = lvlEnd
		
		end	
	
	elseif (lvlState == lvlEnd) then
	
		lvlState = lvlSetup
		if (iLives == 0) then --Game Over 
			
			tempLevel = currentLevel		
			currentLevel = levelContinue
			
		elseif (iLives > 0 and dip_Undertaker == false and not bLevelComplete) then
			
			tempLevel = currentLevel
			currentLevel = levelLivesLeft			
			
		else
			
			if bLevelComplete then			
				
				stage[levelCactus4] = true	
				currentLevel = levelCactus5
				bSection01Reached = false
				bShowdown = true
				
			else
			
				currentLevel = levelMenu		
				
			end			

		end

		if bDebug then debugPrint ("Leaving doLevelCactus4)") end
	
	end

end

function doLevelCactus5()

	if (lvlState == lvlSetup) then
	
		if bDebug then debugPrint ("Entering doLevelCactus5()") end
	
		setupLevel(levelCactus5)
		bLevelComplete = false
		levelFrameStart = thisOffset + 795
		levelFrameEnd   = thisOffset + 3297
		bNoMoreBonuses = false		
		
		if bSection01Reached == true and bSection02Reached == false then
		
			currentMove = 8
			discSkipToFrame(move[currentMove][rndMoveStart])
			
		elseif bSection02Reached == true then
		
			currentMove = 20
			discSkipToFrame(move[currentMove][rndMoveStart])
			
		else
		
			currentMove = 1
			discSkipToFrame(levelFrameStart)	
			
		end
		lvlState = lvlRunning
		
	elseif (lvlState == lvlPlayClip2) then
		
		if (currentFrame == move[currentMove][rndMoveEnd]) then
			
			
			if currentMove == 22 then
				
				discSkipToFrame(thisOffset + 1268)
				currentMove = 3
				lvlState = lvlRunning
				
			else			
			
				currentMove = currentMove + 1
				
				if currentMove == 22 then
				
					currentMove = 23
					lvlState = lvlRunning
				
				elseif (currentMove <= totalMoves) then
					
					discSkipToFrame(move[currentMove][rndMoveStart])
					lvlState = lvlRunning
					
				end
				
				if currentMove == 8 then 
				
					bSection01Reached = true 
					bNoMoreBonuses = false
					
				elseif currentMove == 20 then 
				
					bSection02Reached = true 
					bNoMoreBonuses = false
					
				end				
				
				
			end
			
		elseif (p1BUTTON3) then
			p1BUTTON3 = false
			if (iBullets > 0) then
			
				if (civillianHit(currentFrame - thisOffset) == true) then

						getNags(NAG_FRIENDLYKILLED)	
						discSkipToFrame(nagFrameStart)					
						lvlState = lvlPlayNag
						
				elseif bNoMoreBonuses == false then
					
					local b1 = false
				
					if ((currentFrame >= thisOffset + 794) and (currentFrame <= thisOffset + 1267)) or ((currentFrame >= thisOffset + 1324) and (currentFrame <= thisOffset + 1775)) or ((currentFrame >= thisOffset + 1881) and (currentFrame <= thisOffset + 1990)) then
				
						if mousex >= 73 and mousex <= 79 and mousey >= 82 and mousey <= 98 then
						
							b1 = true
							
						end
						
					elseif (currentFrame >= thisOffset + 2008) and (currentFrame <= thisOffset + 2974) then
				
						if mousex >= 107 and mousex <= 116 and mousey >= 106 and mousey <= 120 then
						
							b1 = true
							
						end
						
					elseif (currentFrame >= thisOffset + 2975) and (currentFrame <= thisOffset + 3127) then
				
						if mousex >= 243 and mousex <= 250 and mousey >= 156 and mousey <= 171 then
						
							b1 = true
							
						end
						
					elseif bonusHit(currentFrame - thisOffset) then
					
						b1 = true
						
					end
					
					if b1 then 
					
						iBullets = 13
						bNoMoreBonuses = true
						playMe(sndBonus)
						
					end	
					
				end
			
			end
		
		end
		
	elseif (lvlState == lvlPause) then
		
		if timerDue() then		
		
			discSkipToFrame(move[currentMove][deathFrameStart])				
			lvlState = lvlPlayDeath	
			
		else
		
			if (p1BUTTON3) then
				p1BUTTON3 = false
				if (iBullets > 0) then
				
					if (shooterHit(currentFrame - thisOffset, currentMove) == true) then -- Bad guy Hit!
					
						iScore = iScore + SCORE_BADGUY
						discSkipToFrame(move[currentMove][moveFrameEnd]+1)
						lvlState = lvlPlayClip2
						
					elseif (civillianHit(currentFrame - thisOffset) == true) then					
						
						discSkipToFrame(move[currentMove][deathFrameStart])				
						lvlState = lvlPlayDeath	
						
					end				
				
				end				
				
			end
		
		end
	
	elseif (lvlState == lvlRunning) then
	
		if (currentMove > totalMoves) then
		
			bLevelComplete = true
			lvlState = lvlEnd
			
		elseif (currentFrame == thisOffset + 2010) then
		
			bSection01Reached = true
			
		elseif (currentFrame > move[currentMove][moveFrameEnd]) then -- Death to player!
		
			if (move[currentMove][rndMoveType] == GOODGUY) then
			
				lvlState = lvlPlayClip2
				
			elseif (currentMove == 2) then -- Dude gets shot
			
				discSkipToFrame(thisOffset + 4459)
				currentMove = 22				
				
			else
				
				discSkipToFrame(move[currentMove][moveFrameEnd])
				discPause()
				timerON(iDelay)
				lvlState = lvlPause
				
			end
		
		elseif (currentFrame >= move[currentMove][moveFrameStart] and currentFrame < move[currentMove][moveFrameEnd]) then
		
			if (p1BUTTON3) then
				p1BUTTON3 = false
				if (iBullets > 0) then
				
					if (shooterHit(currentFrame - thisOffset, currentMove) == true) then -- Bad guy Hit!
					
						iScore = iScore + SCORE_BADGUY
						discSkipToFrame(move[currentMove][moveFrameEnd]+1)
						lvlState = lvlPlayClip2
						
					elseif (civillianHit(currentFrame - thisOffset) == true) then					
						
						discSkipToFrame(move[currentMove][deathFrameStart])				
						lvlState = lvlPlayDeath	
					
					elseif bNoMoreBonuses == false then
					
						local b1 = false
				
						if ((currentFrame >= thisOffset + 794) and (currentFrame <= thisOffset + 1267)) or ((currentFrame >= thisOffset + 1324) and (currentFrame <= thisOffset + 1775)) or ((currentFrame >= thisOffset + 1881) and (currentFrame <= thisOffset + 1990)) then
				
							if mousex >= 73 and mousex <= 79 and mousey >= 82 and mousey <= 98 then
							
								b1 = true
								
							end
						
						elseif (currentFrame >= thisOffset + 2008) and (currentFrame <= thisOffset + 2974) then
				
							if mousex >= 107 and mousex <= 116 and mousey >= 106 and mousey <= 120 then
							
								b1 = true
								
							end
							
						elseif (currentFrame >= thisOffset + 2975) and (currentFrame <= thisOffset + 3127) then
				
							if mousex >= 243 and mousex <= 250 and mousey >= 156 and mousey <= 171 then
							
								b1 = true
								
							end
							
						elseif bonusHit(currentFrame - thisOffset) then
						
							b1 = true
							
						end
						
						if b1 then 
						
							iBullets = 13
							bNoMoreBonuses = true
							playMe(sndBonus)
							
						end	
					
					end				
				
				end				
				
			end
			
		elseif (p1BUTTON3) then
			p1BUTTON3 = false
			if (iBullets > 0) then
			
				if (civillianHit(currentFrame - thisOffset) == true) then				
					
					getNags(NAG_FRIENDLYKILLED)	
					discSkipToFrame(nagFrameStart)					
					lvlState = lvlPlayNag
					
				elseif bNoMoreBonuses == false then
					
					local b1 = false
				
					if ((currentFrame >= thisOffset + 794) and (currentFrame <= thisOffset + 1267)) or ((currentFrame >= thisOffset + 1324) and (currentFrame <= thisOffset + 1775)) or ((currentFrame >= thisOffset + 1881) and (currentFrame <= thisOffset + 1990)) then
				
						if mousex >= 73 and mousex <= 79 and mousey >= 82 and mousey <= 98 then
						
							b1 = true
							
						end
						
					elseif (currentFrame >= thisOffset + 2008) and (currentFrame <= thisOffset + 2974) then
				
						if mousex >= 107 and mousex <= 116 and mousey >= 106 and mousey <= 120 then
						
							b1 = true
							
						end
						
					elseif (currentFrame >= thisOffset + 2975) and (currentFrame <= thisOffset + 3127) then
				
						if mousex >= 243 and mousex <= 250 and mousey >= 156 and mousey <= 171 then
						
							b1 = true
							
						end
						
					elseif bonusHit(currentFrame - thisOffset) then
					
						b1 = true
						
					end
					
					if b1 then 
					
						iBullets = 13
						bNoMoreBonuses = true
						playMe(sndBonus)
						
					end	
					
				end
			
			end
			
		end
		
	elseif (lvlState == lvlPlayDeath) then
	
		if (currentFrame == move[currentMove][deathFrameEnd]) then
		
			if (move[currentMove][rndMoveType] == GOODGUY) then
			
				getNags(NAG_FRIENDLYKILLED)
				
			else
			
				getNags(NAG_NORMAL)			
				
			end
			discSkipToFrame(nagFrameStart)
			lvlState = lvlPlayNag	
			
		end
		
	elseif (lvlState == lvlPlayNag) then
	
		if (currentFrame == nagFrameEnd or p1BUTTON3) then
		
			p1BUTTON3 = false		
			lvlState = lvlEnd
		
		end	
	
	elseif (lvlState == lvlEnd) then
	
		lvlState = lvlSetup
		if (iLives == 0) then --Game Over 
			
			tempLevel = currentLevel		
			currentLevel = levelContinue
			
		elseif (iLives > 0 and dip_Undertaker == false and not bLevelComplete) then
			
			tempLevel = currentLevel
			currentLevel = levelLivesLeft			
			
		else

			if bLevelComplete then			
				
				stage[levelCactus5] = true	
				currentLevel = levelCactus6
				bSection01Reached = false
				bSection02Reached = false
				
			else
			
				currentLevel = levelMenu		
				
			end		
			
		end

		if bDebug then debugPrint ("Leaving doLevelCactus5()") end
	
	end

end

function doLevelCactus6()

	if (lvlState == lvlSetup) then
	
		if bDebug then debugPrint ("Entering doLevelCactus6()") end
	
		setupLevel(levelCactus6)
		levelFrameStart = thisOffset + 3297
		levelFrameEnd   = thisOffset + 4600
		bLevelComplete  = false		
		bNoMoreBonuses  = false
		
		currentMove = 1				
		discSkipToFrame(levelFrameStart)		
		lvlState = lvlRunning
		
	elseif (lvlState == lvlPlayClip1) then
	
		if currentFrame == (offsetMenus + 1098) then
		
			bLevelComplete = true
			lvlState = lvlEnd		
		
		end	
		
	elseif (lvlState == lvlPause) then
	
		if timerDue() then
		
			discSkipToFrame(move[currentMove][deathFrameStart])				
			lvlState = lvlPlayDeath			
			
		else
		
			if (p1BUTTON3) then
				p1BUTTON3 = false
				if (iBullets > 0) then
				
					if (shooterHit(currentFrame - thisOffset, currentMove) == true) then -- Bad guy Hit!
						
						if currentMove == 9 then
						
							iScore = iScore + SCORE_OUTLAW * 0.5														
							panel[STAGE_CACTUS] = DEAD
							discSkipToFrame(15614)
							levelFrameEnd = 15665
							currentMove = currentMove + 1
							
						else
						
							iScore = iScore + SCORE_BADGUY
							discSkipToFrame(move[currentMove][moveFrameEnd]+1)
							currentMove = currentMove + 1						
							
						end
						
						lvlState = lvlRunning
						
					elseif (civillianHit(currentFrame - thisOffset) == true) then						
				
						discSkipToFrame(move[currentMove][deathFrameStart])				
						lvlState = lvlPlayDeath
					

					elseif bNoMoreBonuses == false then
					
						if bonusHit(currentFrame - thisOffset) then
						
							iBullets = 13
							bNoMoreBonuses = true
							playMe(sndBonus)
						
						end
					
					end	
					
				end
				
			end
		
		end
	
	elseif (lvlState == lvlRunning) then
	
		if (currentMove > totalMoves) then
		
			if (currentFrame == levelFrameEnd) then
	
				if panel[STAGE_CACTUS] == DEAD and not bAdviceGiven then
				
					bAdviceGiven = true
					discSkipToFrame(offsetMenus + 952)
					lvlState = lvlPlayClip1
					
				else
		
					bLevelComplete = true			
					lvlState = lvlEnd
					
				end
				
			end
			
		elseif (currentFrame > move[currentMove][moveFrameEnd]) then -- Death to player!
		
			if (move[currentMove][rndMoveType] == GOODGUY) then
			
				currentMove = currentMove + 1
			else
			
				discSkipToFrame(move[currentMove][moveFrameEnd])
				discPause()			
				timerON(iDelay)
				lvlState = lvlPause			
				
			end
		
		elseif (currentFrame >= move[currentMove][moveFrameStart] and currentFrame < move[currentMove][moveFrameEnd]) then
		
			if (p1BUTTON3) then
				p1BUTTON3 = false
				if (iBullets > 0) then
				
					if (shooterHit(currentFrame - thisOffset, currentMove) == true) then -- Bad guy Hit!
					
						if currentMove == 9 then
						
							iScore = iScore + SCORE_OUTLAW * 0.5														
							panel[STAGE_CACTUS] = DEAD
							discSkipToFrame(15614)
							levelFrameEnd = 15665
							currentMove = currentMove + 1
							lvlState = lvlRunning
							
						else
					
							iScore = iScore + SCORE_BADGUY
							discSkipToFrame(move[currentMove][moveFrameEnd]+1)
							currentMove = currentMove + 1
							
						end
						
					elseif (civillianHit(currentFrame - thisOffset) == true) then	

						if currentMove == 9 then
						
							iScore = iScore + SCORE_OUTLAW
							panel[STAGE_CACTUS] = CAPTURED
							discSkipToFrame(move[currentMove][moveFrameEnd]+1)
							levelFrameEnd = thisOffset + 4458
							currentMove = currentMove + 1
							lvlState = lvlRunning
							
						else
					
							discSkipToFrame(move[currentMove][deathFrameStart])				
							lvlState = lvlPlayDeath
							
						end
					
					elseif bNoMoreBonuses == false then
					
						if ((currentFrame >= thisOffset + 3309) and (currentFrame <= thisOffset + 3627)) or ((currentFrame >= thisOffset + 3768) and (currentFrame <= thisOffset + 4045)) then
				
							if mousex >= 207 and mousex <= 215 and mousey >= 117 and mousey <= 131 then
						
								iBullets = 13
								bNoMoreBonuses = true
								playMe(sndBonus)
								
							end
						
						end
					
					end
				
				end				
				
			end
			
		else
		
			if (p1BUTTON3) then
		
				if bNoMoreBonuses == false then
					
					if ((currentFrame >= thisOffset + 3309) and (currentFrame <= thisOffset + 3627)) or ((currentFrame >= thisOffset + 3768) and (currentFrame <= thisOffset + 4045)) then
				
						if mousex >= 207 and mousex <= 215 and mousey >= 117 and mousey <= 131 then
						
							iBullets = 13
							bNoMoreBonuses = true
							playMe(sndBonus)
							
						end
					
					end
					
				end
				
			end
			
		end
		
	elseif (lvlState == lvlPlayDeath) then
	
		if (currentFrame == move[currentMove][deathFrameEnd]) then
		
			if (move[currentMove][rndMoveType] == GOODGUY) then
			
				getNags(NAG_FRIENDLYKILLED)
				
			else
			
				getNags(NAG_NORMAL)
				
			end
			discSkipToFrame(nagFrameStart)
			lvlState = lvlPlayNag			
				
		
		end
		
	elseif (lvlState == lvlPlayNag) then
	
		if (currentFrame == nagFrameEnd or p1BUTTON3) then
		
			p1BUTTON3 = false		
			lvlState = lvlEnd
		
		end	
	
	elseif (lvlState == lvlEnd) then
	
		lvlState = lvlSetup
		if (iLives == 0) then --Game Over 
			
			tempLevel = currentLevel		
			currentLevel = levelContinue
			
		elseif (iLives > 0 and dip_Undertaker == false and not bLevelComplete) then
			
			tempLevel = currentLevel
			currentLevel = levelLivesLeft			
			
		else
			
			if bLevelComplete then			
				
				stage[levelCactus6] = true					
				bSection01Reached = false
				
			end
			currentLevel = levelMenu			

		end

		if bDebug then debugPrint ("Leaving doLevelCactus6()") end
	
	end

end

function doLevelDan1()

	if (lvlState == lvlSetup) then
	
		if bDebug then debugPrint ("Entering doLevelDan1()") end
	
		setupLevel(levelDan1)
		levelFrameStart = thisOffset
		levelFrameEnd   = thisOffset + 832
		bLevelComplete  = false		
		bNoMoreBonuses  = false
		
		if bSection01Reached then
		
			currentMove = 4
			discSkipToFrame(move[currentMove][rndMoveStart])			
			
		else
		
			currentMove = 1				
			discSkipToFrame(levelFrameStart)
			
		end
		
		lvlState = lvlRunning
		
	elseif (lvlState == lvlPlayClip1) then
	
		if currentFrame == levelFrameEnd then
		
			bLevelComplete = true			
			lvlState = lvlEnd
		
		end		
		
	elseif (lvlState == lvlPlayClip2) then
	
		if (currentFrame == move[currentMove][rndMoveEnd]) then
			
			currentMove = currentMove + 1
			
			if (currentMove <= totalMoves) then
				
				discSkipToFrame(move[currentMove][rndMoveStart])
				
			end
				
			lvlState = lvlRunning
			if currentMove == 4 then bSection01Reached = true end
			
		elseif (p1BUTTON3) then
			p1BUTTON3 = false
			if (iBullets > 0) then
			
				if bNoMoreBonuses == false then
				
					local b1 = false
				
					if (currentFrame >= thisOffset + 440) and (currentFrame <= thisOffset + 815) then
				
						if mousex >= 257 and mousex <= 263 and mousey >= 125 and mousey <= 132 then
						
							b1 = true
						
						end					
						
					elseif bonusHit(currentFrame - thisOffset) then
					
						b1 = true
						
					end
					
					if b1 then 
					
						iBullets = 13
						bNoMoreBonuses = true
						playMe(sndBonus)
						
					end
					
				end
			
			end
		
		end
	
		
	elseif (lvlState == lvlPause) then
	
		if timerDue() then
		
			discSkipToFrame(move[currentMove][deathFrameStart])				
			lvlState = lvlPlayDeath			
			
		else
		
			if (p1BUTTON3) then
				p1BUTTON3 = false
				if (iBullets > 0) then
				
					if (shooterHit(currentFrame - thisOffset, currentMove) == true) then -- Bad guy Hit!
						
						iScore = iScore + SCORE_BADGUY
						discSkipToFrame(move[currentMove][moveFrameEnd]+1)
						lvlState = lvlPlayClip2
					
					end	

					if currentMove == 4 then bSection01Reached = true end					
				end
				
			end
		
		end
	
	elseif (lvlState == lvlRunning) then
	
		if (currentMove > totalMoves) then
		
			discSkipToFrame(thisOffset + 820)
			lvlState = lvlPlayClip1
	
		elseif (currentFrame > move[currentMove][moveFrameEnd]) then -- Death to player!
		
			if (move[currentMove][rndMoveType] == GOODGUY) then
			
				lvlState = lvlPlayClip2
				
			else
			
				discSkipToFrame(move[currentMove][moveFrameEnd])
				discPause()			
				timerON(iDelay)
				lvlState = lvlPause			
				
			end
		
		elseif (currentFrame >= move[currentMove][moveFrameStart] and currentFrame < move[currentMove][moveFrameEnd]) then
		
			if (p1BUTTON3) then
				p1BUTTON3 = false
				if (iBullets > 0) then
				
					if (shooterHit(currentFrame - thisOffset, currentMove) == true) then -- Bad guy Hit!
					
						iScore = iScore + SCORE_BADGUY
						discSkipToFrame(move[currentMove][moveFrameEnd]+1)		
						
						lvlState = lvlPlayClip2
						
					elseif (civillianHit(currentFrame - thisOffset) == true) then						
					
						discSkipToFrame(move[currentMove][deathFrameStart])				
						lvlState = lvlPlayDeath
					
					elseif bNoMoreBonuses == false then
					
						local b1 = false
				
						if (currentFrame >= thisOffset + 440) and (currentFrame <= thisOffset + 815) then
					
							if mousex >= 257 and mousex <= 263 and mousey >= 125 and mousey <= 132 then
							
								b1 = true
							
							end					
							
						elseif bonusHit(currentFrame - thisOffset) then
						
							b1 = true
							
						end
						
						if b1 then 
						
							iBullets = 13
							bNoMoreBonuses = true
							playMe(sndBonus)
							
						end
					
					end
				
				end				
				
			end
			
		else
		
			if (p1BUTTON3) then
				p1BUTTON3 = false
				if bNoMoreBonuses == false then
					
					if bonusHit(currentFrame - thisOffset) then
					
						iBullets = 13
						bNoMoreBonuses = true
						playMe(sndBonus)
					
					end
					
				end
				
			end
			
		end
		
	elseif (lvlState == lvlPlayDeath) then
	
		if (currentFrame == move[currentMove][deathFrameEnd]) then
		
			if (move[currentMove][rndMoveType] == GOODGUY) then
			
				getNags(NAG_FRIENDLYKILLED)
				
			else
			
				getNags(NAG_NORMAL)
				
			end
			discSkipToFrame(nagFrameStart)
			lvlState = lvlPlayNag			
				
		
		end
		
	elseif (lvlState == lvlPlayNag) then
	
		if (currentFrame == nagFrameEnd or p1BUTTON3) then
		
			p1BUTTON3 = false		
			lvlState = lvlEnd
		
		end	
	
	elseif (lvlState == lvlEnd) then
	
		lvlState = lvlSetup
		if (iLives == 0) then --Game Over 
			
			tempLevel = currentLevel		
			currentLevel = levelContinue
			
		elseif (iLives > 0 and dip_Undertaker == false and not bLevelComplete) then
			
			tempLevel = currentLevel
			currentLevel = levelLivesLeft			
			
		else
			
			if bLevelComplete then			
				
				stage[levelDan1] = true
				currentLevel = levelDan2
				bSection01Reached = false
				bShowdown = true
				
			else
			
				currentLevel = levelMenu
				
			end			
			

		end

		if bDebug then debugPrint ("Leaving doLevelDan1()") end
	
	end

end

function doLevelDan2()

	if (lvlState == lvlSetup) then
	
		if bDebug then debugPrint ("Entering doLevelDan2()") end
	
		setupLevel(levelDan2)
		levelFrameStart = thisOffset
		levelFrameEnd   = thisOffset + 610
		bLevelComplete  = false		
		bNoMoreBonuses  = false
		
		currentMove = 1				
		discSkipToFrame(levelFrameStart)		
		lvlState = lvlRunning
		
	elseif (lvlState == lvlPlayClip1) then
	
		if currentFrame == levelFrameEnd then
		
			bLevelComplete = true			
			lvlState = lvlEnd
		
		end			
		
	elseif (lvlState == lvlPause) then
	
		if timerDue() then
		
			discSkipToFrame(move[currentMove][deathFrameStart])				
			lvlState = lvlPlayDeath			
			
		else
		
			if (p1BUTTON3) then
				p1BUTTON3 = false
				if (iBullets > 0) then
				
					if (shooterHit(currentFrame - thisOffset, currentMove) == true) then -- Bad guy Hit!
						
						iScore = iScore + SCORE_BADGUY
						discSkipToFrame(move[currentMove][moveFrameEnd]+1)
						lvlState = lvlRunning
						currentMove = currentMove + 1
					
					end	

				end
				
			end
		
		end
	
	elseif (lvlState == lvlRunning) then
	
		if (currentMove > totalMoves) then		
		
			if currentFrame == levelFrameEnd then
		
				bLevelComplete = true
				lvlState = lvlEnd
				
			end
	
		elseif (currentFrame > move[currentMove][moveFrameEnd]) then -- Death to player!
		
			if (move[currentMove][rndMoveType] == GOODGUY) then
			
				currentMove = currentMove + 1
				
			else
			
				discSkipToFrame(move[currentMove][moveFrameEnd])
				discPause()			
				timerON(iDelay)
				lvlState = lvlPause			
				
			end
		
		elseif (currentFrame >= move[currentMove][moveFrameStart] and currentFrame < move[currentMove][moveFrameEnd]) then
		
			if (p1BUTTON3) then
				p1BUTTON3 = false
				if (iBullets > 0) then
				
					if (shooterHit(currentFrame - thisOffset, currentMove) == true) then -- Bad guy Hit!
					
						iScore = iScore + SCORE_BADGUY
						discSkipToFrame(move[currentMove][moveFrameEnd]+1)		
						
						currentMove = currentMove + 1
					
					end
				
				end				
				
			end			
			
		end
		
	elseif (lvlState == lvlPlayDeath) then
	
		if (currentFrame == move[currentMove][deathFrameEnd]) then
		
			if (move[currentMove][rndMoveType] == GOODGUY) then
			
				getNags(NAG_FRIENDLYKILLED)
				
			else
			
				getNags(NAG_NORMAL)
				
			end
			discSkipToFrame(nagFrameStart)
			lvlState = lvlPlayNag			
				
		
		end
		
	elseif (lvlState == lvlPlayNag) then
	
		if (currentFrame == nagFrameEnd or p1BUTTON3) then
		
			p1BUTTON3 = false		
			lvlState = lvlEnd
		
		end	
	
	elseif (lvlState == lvlEnd) then
	
		lvlState = lvlSetup
		if (iLives == 0) then --Game Over 
			
			tempLevel = currentLevel		
			currentLevel = levelContinue
			
		elseif (iLives > 0 and dip_Undertaker == false and not bLevelComplete) then
			
			tempLevel = currentLevel
			currentLevel = levelLivesLeft			
			
		else
			
			if bLevelComplete then			
				
				stage[levelDan2] = true
				currentLevel = levelDan3
				bSection01Reached = false
				bShowdown = true
				
			else
			
				currentLevel = levelMenu
				
			end			
			

		end

		if bDebug then debugPrint ("Leaving doLevelDan2()") end
	
	end

end

function doLevelDan3()

	if (lvlState == lvlSetup) then
	
		if bDebug then debugPrint ("Entering doLevelDan3()") end
	
		setupLevel(levelDan3)
		levelFrameStart = thisOffset + 832
		levelFrameEnd   = thisOffset + 3729
		bLevelComplete  = false		
		bNoMoreBonuses  = false		
		
		if bSection01Reached and not bSection02Reached then
		
			currentMove = 1
			discSkipToFrame(thisOffset + 950)
			lvlState = lvlRunning
			
		elseif bSection02Reached and not bSection03Reached then
		
			currentMove = 7
			discSkipToFrame(thisOffset + 1510)
			lvlState = lvlRunning
			
		elseif bSection03Reached then
		
			currentMove = 13
			discSkipToFrame(thisOffset + 2106)
			lvlState = lvlRunning
			
		else
		
			currentMove = 1				
			discSkipToFrame(levelFrameStart)
			lvlState = lvlPlayClip1
			
		end
		
	elseif (lvlState == lvlPlayClip1) then
	
		if currentFrame == (thisOffset + 950) then
		
			bSectionO1Reached = true
			lvlState = lvlRunning
		
		end	
	
	elseif (lvlState == lvlPlayClip2) then
	
		if currentFrame == 42909 then
		
			discSkipToFrame(offsetMenus + 940)
			lvlState = lvlPlayClip3		
		
		end
		
	elseif (lvlState == lvlPlayClip3) then
	
		if currentFrame == (offsetMenus + 1098) then
		
			bLevelComplete = true
			lvlState = lvlEnd		
		
		end
		
	elseif (lvlState == lvlPause) then
	
		if timerDue() then
		
			discSkipToFrame(move[currentMove][deathFrameStart])				
			lvlState = lvlPlayDeath			
			
		else
		
			if (p1BUTTON3) then
				p1BUTTON3 = false
				if (iBullets > 0) then
				
					if (shooterHit(currentFrame - thisOffset, currentMove) == true) then -- Bad guy Hit!
						
						
						if currentMove == 19 then
						
							iScore = iScore + SCORE_OUTLAW * 0.5														
							panel[STAGE_DAN] = DEAD
							discSkipToFrame(42846)
							currentMove = currentMove + 1
							lvlState = lvlRunning
						
						else
						
							iScore = iScore + SCORE_BADGUY
							discSkipToFrame(move[currentMove][moveFrameEnd]+1)							
							currentMove = currentMove + 1
							
						end
						lvlState = lvlRunning
					
					end	

					if currentMove == 7 then bSection02Reached = true end					
					if currentMove == 13 then bSection03Reached = true end		
			
				end
				
			end
		
		end
	
	elseif (lvlState == lvlRunning) then
	
		if (currentMove > totalMoves) then
		
			if currentFrame == levelFrameEnd then
			
				if panel[STAGE_DAN] == DEAD and not bAdviceGiven then
				
					bAdviceGiven = true
					discSkipToFrame(offsetMenus + 952)
					lvlState = lvlPlayClip3
					
				else
		
					bLevelComplete = true			
					lvlState = lvlEnd
					
				end
			
			end	
	
		elseif (currentFrame > move[currentMove][moveFrameEnd]) then -- Death to player!
		
			if (move[currentMove][rndMoveType] == GOODGUY) then
			
				currentMove = currentMove + 1
				
			else
			
				discSkipToFrame(move[currentMove][moveFrameEnd])
				discPause()			
				timerON(iDelay)
				lvlState = lvlPause			
				
			end
		
		elseif (currentFrame >= move[currentMove][moveFrameStart] and currentFrame < move[currentMove][moveFrameEnd]) then
		
			if (p1BUTTON3) then
				p1BUTTON3 = false
				if (iBullets > 0) then
				
					if (shooterHit(currentFrame - thisOffset, currentMove) == true) then -- Bad guy Hit!
					
						if currentMove == 19 then
						
							iScore = iScore + SCORE_OUTLAW * 0.5														
							panel[STAGE_DAN] = DEAD
							discSkipToFrame(42846)
							currentMove = currentMove + 1
							lvlState = lvlPlayClip2
						
						else					
					
							iScore = iScore + SCORE_BADGUY
							discSkipToFrame(move[currentMove][moveFrameEnd]+1)								
							currentMove = currentMove + 1
							if currentMove == 7 then bSection02Reached = true end					
							if currentMove == 13 then bSection03Reached = true end	
							
						end
						
					elseif (civillianHit(currentFrame - thisOffset) == true) then	

						if currentMove == 19 then
						
							iScore = iScore + SCORE_OUTLAW														
							panel[STAGE_DAN] = CAPTURED
							discSkipToFrame(move[currentMove][moveFrameEnd]+1)
							currentMove = currentMove + 1
						
						else
					
							discSkipToFrame(move[currentMove][deathFrameStart])				
							lvlState = lvlPlayDeath
							
						end
					
					elseif bNoMoreBonuses == false then
					
						local b1 = false
				
						if (currentFrame >= thisOffset + 960) and (currentFrame <= thisOffset + 1500) then
					
							if mousex >= 219 and mousex <= 227 and mousey >= 67 and mousey <= 76 then
							
								b1 = true
							
							end					
							
						elseif bonusHit(currentFrame - thisOffset) then
						
							b1 = true
							
						end
						
						if b1 then 
						
							iBullets = 13
							bNoMoreBonuses = true
							playMe(sndBonus)
							
						end
					
					end
				
				end				
				
			end
			
		else
		
			if (p1BUTTON3) then
				p1BUTTON3 = false
				if bNoMoreBonuses == false then
					
					local b1 = false
			
					if (currentFrame >= thisOffset + 960) and (currentFrame <= thisOffset + 1500) then
				
						if mousex >= 219 and mousex <= 227 and mousey >= 67 and mousey <= 76 then
						
							b1 = true
						
						end					
						
					elseif bonusHit(currentFrame - thisOffset) then
					
						b1 = true
						
					end
					
					if b1 then 
					
						iBullets = 13
						bNoMoreBonuses = true
						playMe(sndBonus)
						
					end
					
				end
				
			end
			
		end
		
	elseif (lvlState == lvlPlayDeath) then
	
		if (currentFrame == move[currentMove][deathFrameEnd]) then
		
			if (move[currentMove][rndMoveType] == GOODGUY) then
			
				getNags(NAG_FRIENDLYKILLED)
				
			else
			
				getNags(NAG_NORMAL)
				
			end
			discSkipToFrame(nagFrameStart)
			lvlState = lvlPlayNag			
				
		
		end
		
	elseif (lvlState == lvlPlayNag) then
	
		if (currentFrame == nagFrameEnd or p1BUTTON3) then
		
			p1BUTTON3 = false		
			lvlState = lvlEnd
		
		end	
	
	elseif (lvlState == lvlEnd) then
	
		lvlState = lvlSetup
		if (iLives == 0) then --Game Over 
			
			tempLevel = currentLevel		
			currentLevel = levelContinue
			
		elseif (iLives > 0 and dip_Undertaker == false and not bLevelComplete) then
			
			tempLevel = currentLevel
			currentLevel = levelLivesLeft			
			
		else
			
			if bLevelComplete then			
				
				stage[levelDan3] = true				
				bSection01Reached = false
				bSection02Reached = false
				
			end
			currentLevel = levelMenu

		end

		if bDebug then debugPrint ("Leaving doLevelDan3()") end
	
	end

end

function doLevelFinal1()

	if (lvlState == lvlSetup) then
	
		if bDebug then debugPrint ("Entering doLevelFinal1()") end
	
		setupLevel(levelFinal1)
		levelFrameStart = thisOffset
		levelFrameEnd   = thisOffset + 1655
		bLevelComplete  = false		
		bNoMoreBonuses  = false
		
		
		if bSection01Reached and not bSection02Reached then
		
			discSkipToFrame(thisOffset + 263)
			lvlState = lvlRunning
			currentMove = 1
			
		elseif bSection02Reached then
		
			currentMove = 4
			lvlState = lvlRunning
			discSkipToFrame(thisOffset + 618)
			
		else
			
			discSkipToFrame(levelFrameStart)		
			lvlState = lvlPlayClip2
			currentMove = 1				
			
		end
		
	elseif (lvlState == lvlPlayClip2) then
	
		if currentFrame == thisOffset + 263 then
		
			discSkipToFrame(thisOffset + 263)
			lvlState = lvlRunning
			bSection01Reached = true
		
		elseif p1BUTTON3 then
		
			discSkipToFrame(thisOffset + 263)
			lvlState = lvlRunning
			bSection01Reached = true
		
		end
		
	elseif (lvlState == lvlPause) then
	
		if timerDue() then
		
			discSkipToFrame(move[currentMove][deathFrameStart])				
			lvlState = lvlPlayDeath			
			
		else
		
			if (p1BUTTON3) then
				p1BUTTON3 = false
				if (iBullets > 0) then
				
					if (shooterHit(currentFrame - thisOffset, currentMove) == true) then -- Bad guy Hit!
						
						iScore = iScore + SCORE_BADGUY
						discSkipToFrame(move[currentMove][moveFrameEnd]+1)
						lvlState = lvlRunning
						currentMove = currentMove + 1
					
					end	

				end
				
			end
		
		end
	
	elseif (lvlState == lvlRunning) then
	
		if (currentMove > totalMoves) then		
		
			if currentFrame == levelFrameEnd then
			
				bLevelComplete = true
				lvlState = lvlEnd
				
			end
	
		elseif (currentFrame > move[currentMove][moveFrameEnd]) then -- Death to player!
		
			if (move[currentMove][rndMoveType] == GOODGUY) then
			
				currentMove = currentMove + 1
				
			else
			
				discSkipToFrame(move[currentMove][moveFrameEnd])
				discPause()			
				timerON(iDelay)
				lvlState = lvlPause			
				
			end
		
		elseif (currentFrame >= move[currentMove][moveFrameStart] and currentFrame < move[currentMove][moveFrameEnd]) then
		
			if (p1BUTTON3) then
				p1BUTTON3 = false
				if (iBullets > 0) then
				
					if (shooterHit(currentFrame - thisOffset, currentMove) == true) then -- Bad guy Hit!
					
						iScore = iScore + SCORE_BADGUY
						discSkipToFrame(move[currentMove][moveFrameEnd]+1)		
						
						currentMove = currentMove + 1
						if currentMove == 4 then bSection02Reached = true end
						
					elseif (civillianHit(currentFrame - thisOffset) == true) then						
					
						discSkipToFrame(move[currentMove][deathFrameStart])				
						lvlState = lvlPlayDeath
					
					elseif bNoMoreBonuses == false then					
						
						if (currentFrame >= thisOffset + 624) and (currentFrame <= thisOffset + 1425) then
					
							if (mousex >= 225 and mousex <= 232 and mousey >= 128 and mousey <= 134) then
							
								iBullets = 13
								bNoMoreBonuses = true
								playMe(sndBonus)
								
							end					
							
						end
						
					end
					
				end				
				
			end		
			
		else
		
			if bNoMoreBonuses == false then
			
				if p1BUTTON3 then
				
					if (currentFrame >= thisOffset + 624) and (currentFrame <= thisOffset + 1425) then
				
						if (mousex >= 225 and mousex <= 232 and mousey >= 128 and mousey <= 134) then
						
							iBullets = 13
							bNoMoreBonuses = true
							playMe(sndBonus)
							
						end					
						
					end
				end
				
			end
			
		end
		
	elseif (lvlState == lvlPlayDeath) then
	
		if (currentFrame == move[currentMove][deathFrameEnd]) then
		
			if (move[currentMove][rndMoveType] == GOODGUY) then
			
				getNags(NAG_FRIENDLYKILLED)
				
			else
			
				getNags(NAG_NORMAL)
				
			end
			discSkipToFrame(nagFrameStart)
			lvlState = lvlPlayNag			
				
		
		end
		
	elseif (lvlState == lvlPlayNag) then
	
		if (currentFrame == nagFrameEnd or p1BUTTON3) then
		
			p1BUTTON3 = false		
			lvlState = lvlEnd
		
		end	
	
	elseif (lvlState == lvlEnd) then
	
		lvlState = lvlSetup
		if (iLives == 0) then --Game Over 
			
			tempLevel = currentLevel		
			currentLevel = levelContinue
			
		elseif (iLives > 0 and dip_Undertaker == false and not bLevelComplete) then
			
			tempLevel = currentLevel
			currentLevel = levelLivesLeft			
			
		else
			
			if bLevelComplete then			
				
				stage[levelFinal1] = true
				currentLevel = levelFinal2
				bSection01Reached = false
				bSection02Reached = false				
				
			else
			
				currentLevel = levelMenu
				
			end			
			

		end

		if bDebug then debugPrint ("Leaving doLevelFinal1()") end
	
	end

end

function doLevelFinal2()

	if (lvlState == lvlSetup) then
	
		if bDebug then debugPrint ("Entering doLevelFinal2()") end
	
		setupLevel(levelFinal2)
		
		if totalMoves == 0 then
		
			discSkipToFrame(thisOffset + 1655)
			lvlState = lvlPlayClip1
		
		else	
	
			currentMove = 1
			
			if (move[currentMove][deathFrameStart] == 29862) then   -- Special case. Cactus kid showdown. Unarm player.
			
				iBullets = 0
				bReloadDisabled = true
				
			else
			
				bReloadDisabled = false
			
			end
			
			levelFrameStart = move[currentMove][rndMoveStart]
			levelFrameEnd   = thisOffset + 832
			bLevelComplete  = false		
			bNoMoreBonuses  = false				
			discSkipToFrame(levelFrameStart)		
			lvlState = lvlRunning
			
		end
		
	elseif (lvlState == lvlPlayClip1) then
	
		if currentFrame == thisOffset + 2068 then
		
			-- If an outlaw was not captured, show Trixie's advice clip.
			
			if panel[STAGE_HARRY] == DEAD or panel[STAGE_DAN] == DEAD or panel[STAGE_LOCO] == DEAD or panel[STAGE_CACTUS] == DEAD then
			
				iFrameStart = thisOffset + 3244
				iFrameEnd = thisOffset + 3467
				discSkipToFrame(iFrameStart)
				lvlState = lvlPlayClip3
				
			else
			
				bLevelComplete = true
				lvlState = lvlEnd				
				
			end
		
		end

	elseif (lvlState == lvlPlayClip3) then
	
		if currentFrame == iFrameEnd then
		
			bLevelComplete = true			
			lvlState = lvlEnd
		
		end
		
	elseif (lvlState == lvlPlayClip2) then
	
		if move[currentMove][deathFrameStart] == 29252 then -- special case. player shot harry. skip to video showing harry shooting back					
			
			currentMove = currentMove + 1 
			discSkipToFrame(move[currentMove][rndMoveStart])
			lvlState = lvlRunning
			
		elseif (currentFrame == move[currentMove][rndMoveEnd]) then
			
			currentMove = currentMove + 1 
			if (currentMove <= totalMoves) then
				
				discSkipToFrame(move[currentMove][rndMoveStart])
				if (move[currentMove][deathFrameStart] == 29862) then   -- Special case. Cactus kid showdown. Unarm player.
			
					iBullets = 0
					bReloadDisabled = true
				
				end
				
			end
				
			lvlState = lvlRunning
			if currentMove == 4 then bSection01Reached = true end
		
		end	
		
	elseif (lvlState == lvlPause) then
	
		if timerDue() then
		
			discSkipToFrame(move[currentMove][deathFrameStart])				
			lvlState = lvlPlayDeath			
			
		else
		
			if (p1BUTTON3) then
				p1BUTTON3 = false
				if (iBullets > 0) then
				
					if (shooterHit(currentFrame - thisOffset, currentMove) == true) then -- Bad guy Hit!
						
						if move[currentMove][deathFrameStart] == 29296 then	-- special case. player shot harry. skip to video showing harry shooting back										
							move[currentMove][moveFrameEnd] = 29379
							move[currentMove][rndMoveEnd] = 29436
							
						end
						discSkipToFrame(move[currentMove][moveFrameEnd]+1)		
						iScore = iScore + SCORE_BADGUY						
						lvlState = lvlPlayClip2
					
					end	
					
				end
				
			end
		
		end
	
	elseif (lvlState == lvlRunning) then
	
		if (currentMove > totalMoves) then
		
			discSkipToFrame(thisOffset + 1655)
			lvlState = lvlPlayClip1
	
		elseif (currentFrame == move[currentMove][moveFrameEnd]) then -- Death to player!
		
			if (move[currentMove][rndMoveType] == GOODGUY) then
			
				lvlState = lvlPlayClip2
				
			elseif move[currentMove][deathFrameStart] == 29252 then -- Special case. Player took Harry's bribe.
			
				currentMove = currentMove + 2 		-- Skip Harry's shooting back move.	
				if currentMove > totalMoves then 	-- If Harry is the last outlaw in the random order. 
													-- then adding 2 moves maked the index go out of bounds.
													-- Avoid this by redirecting branch flow to show ending clip.
					discSkipToFrame(thisOffset + 1655)
					lvlState = lvlPlayClip1
					
				else
			
					discSkipToFrame(move[currentMove][rndMoveStart])
					
				end
				iScore = iScore + 500				
				
			else
			
				discSkipToFrame(move[currentMove][moveFrameEnd])
				discPause()			
				timerON(iDelay)
				lvlState = lvlPause			
				
			end
			
		elseif (currentFrame == 27981) then   -- Re-arm player for Cactus Kid showdown.
			
				bReloadDisabled = false
		
		elseif (currentFrame >= move[currentMove][moveFrameStart] and currentFrame < move[currentMove][moveFrameEnd]) then
		
			if (p1BUTTON3) then
				p1BUTTON3 = false
				if (iBullets > 0) then
				
					if (shooterHit(currentFrame - thisOffset, currentMove) == true) then -- Bad guy Hit!					
					
						if move[currentMove][deathFrameStart] == 29296 then	-- special case. player shot harry. skip to video showing harry shooting back					
							move[currentMove][moveFrameEnd] = 29379
							move[currentMove][rndMoveEnd] = 29436
							
						end
						discSkipToFrame(move[currentMove][moveFrameEnd]+1)		
						iScore = iScore + SCORE_BADGUY						
						lvlState = lvlPlayClip2
					
					end
				
				end				
				
			end
			
		else
		
			if (p1BUTTON3) then
				p1BUTTON3 = false
				if bNoMoreBonuses == false then
					
					if bonusHit(currentFrame - thisOffset) then
					
						iBullets = 13
						bNoMoreBonuses = true
						playMe(sndBonus)
					
					end
					
				end
				
			end
			
		end
		
	elseif (lvlState == lvlPlayDeath) then
	
		if (currentFrame == move[currentMove][deathFrameEnd]) then
		
			if (move[currentMove][rndMoveType] == GOODGUY) then
			
				getNags(NAG_FRIENDLYKILLED)
				
			else
			
				getNags(NAG_NORMAL)
				
			end
			discSkipToFrame(nagFrameStart)
			lvlState = lvlPlayNag			
				
		
		end
		
	elseif (lvlState == lvlPlayNag) then
	
		if (currentFrame == nagFrameEnd or p1BUTTON3) then
		
			p1BUTTON3 = false		
			lvlState = lvlEnd
		
		end	
	
	elseif (lvlState == lvlEnd) then
	
		lvlState = lvlSetup
		if (iLives == 0) then --Game Over 
			
			tempLevel = currentLevel		
			currentLevel = levelContinue
			
		elseif (iLives > 0 and dip_Undertaker == false and not bLevelComplete) then
			
			tempLevel = currentLevel
			currentLevel = levelLivesLeft			
			
		else
			
			if bLevelComplete then	
			
				stage[levelFinal2] = true
				if newScore(iScore) == false then
				
					currentLevel = levelGameOver
					
				else				
				
					currentLevel = levelHighScore
					
				end
				bSection01Reached = false
				
			end			
			

		end

		if bDebug then debugPrint ("Leaving doLevelFinal2()") end
	
	end

end

function doLevelHarry1()

	if (lvlState == lvlSetup) then
	
		if bDebug then debugPrint ("Entering doLevelHarry1()") end
	
		setupLevel(levelHarry1)
		bLevelComplete  = false
		levelFrameStart = thisOffset 
		levelFrameEnd   = thisOffset + 1924	
		
		currentMove = 1
		setupClip(offsetMenus + 3475, offsetMenus + 3580)
		lvlState = lvlPlayClip3
	
	elseif (lvlState == lvlPlayClip1) then
	
		if (currentFrame == thisOffset + 878) then
		
			bLevelComplete = true
			lvlState = lvlEnd
		
		end
	
	elseif (lvlState == lvlPlayClip2) then
		
		if (currentFrame == move[currentMove][rndMoveEnd]) then
			
			currentMove = currentMove + 1
			
			if (currentMove <= totalMoves) then
				
				discSkipToFrame(move[currentMove][rndMoveStart])
				
			end
				
			lvlState = lvlRunning
			
		elseif (p1BUTTON3) then
			p1BUTTON3 = false
			if (iBullets > 0) then
			
				if (civillianHit(currentFrame - thisOffset) == true) then

						getNags(NAG_FRIENDLYKILLED)	
						discSkipToFrame(nagFrameStart)					
						lvlState = lvlPlayNag
						
				elseif bNoMoreBonuses == false then
					
					local b1 = false
				
					if (currentFrame >= thisOffset + 244) and (currentFrame <= thisOffset + 860) then
				
						if mousex >= 208 and mousex <= 225 and mousey >= 181 and mousey <= 194 then
						
							b1 = true
						
						end					
						
					elseif bonusHit(currentFrame - thisOffset) then
					
						b1 = true
						
					end
					
					if b1 then 
					
						iBullets = 13
						bNoMoreBonuses = true
						playMe(sndBonus)
						
					end	
					
				end
			
			end
		
		end
		
	elseif (lvlState == lvlPlayClip3) then
		if (currentFrame == iFrameEnd) then
		debugPrint("D2")
			lvlState = lvlRunning
			discSkipToFrame(levelFrameStart)
		
		end
		
	elseif (lvlState == lvlPause) then
		
		if timerDue() then
		
			discSkipToFrame(move[currentMove][deathFrameStart])				
			lvlState = lvlPlayDeath	
			
		else
		
			if (p1BUTTON3) then
				p1BUTTON3 = false
				if (iBullets > 0) then
				
					if (shooterHit(currentFrame - thisOffset, currentMove) == true) then -- Bad guy Hit!
					
						iScore = iScore + SCORE_BADGUY
						discSkipToFrame(move[currentMove][moveFrameEnd]+1)
						lvlState = lvlPlayClip2
						
					elseif (civillianHit(currentFrame - thisOffset) == true) then					
						
						if (currentMove == 1) then						
							
							move[currentMove][deathFrameStart] = 32022
							move[currentMove][deathFrameEnd] = 32082
							move[currentMove][rndMoveType] = GOODGUY
						
						end
						
						discSkipToFrame(move[currentMove][deathFrameStart])				
						lvlState = lvlPlayDeath	
						
					end				
				
				end				
				
			end
		
		end
	
	elseif (lvlState == lvlRunning) then
	
		if (currentMove > totalMoves) then
		
			discSkipToFrame(thisOffset + 865)
			lvlState = lvlPlayClip1
			
		elseif (currentFrame > move[currentMove][moveFrameEnd]) then -- Death to player!
		
			if (move[currentMove][rndMoveType] == GOODGUY) then
			
				lvlState = lvlPlayClip2
			
			else
				
				discSkipToFrame(move[currentMove][moveFrameEnd])
				discPause()
				timerON(iDelay)
				lvlState = lvlPause
				
			end
		
		elseif (currentFrame >= move[currentMove][moveFrameStart] and currentFrame < move[currentMove][moveFrameEnd]) then
		
			if (p1BUTTON3) then
				p1BUTTON3 = false
				if (iBullets > 0) then
				
					if (shooterHit(currentFrame - thisOffset, currentMove) == true) then -- Bad guy Hit!
					
						iScore = iScore + SCORE_BADGUY
						discSkipToFrame(move[currentMove][moveFrameEnd]+1)
						lvlState = lvlPlayClip2
						
					elseif (civillianHit(currentFrame - thisOffset) == true) then					
					
						if (currentMove == 1) then						
							
							move[currentMove][deathFrameStart] = 32022
							move[currentMove][deathFrameEnd] = 32082
							move[currentMove][rndMoveType] = GOODGUY
							
						end
						
						discSkipToFrame(move[currentMove][deathFrameStart])				
						lvlState = lvlPlayDeath	
					
					elseif bNoMoreBonuses == false then
					
						local b1 = false
				
						if (currentFrame >= thisOffset + 244) and (currentFrame <= thisOffset + 860) then
					
							if mousex >= 208 and mousex <= 225 and mousey >= 181 and mousey <= 194 then
							
								b1 = true
							
							end
							
						elseif bonusHit(currentFrame - thisOffset) then
						
							b1 = true
							
						end
						
						if b1 then 
						
							iBullets = 13
							bNoMoreBonuses = true
							playMe(sndBonus)
							
						end	
					
					end				
				
				end				
				
			end
			
		elseif (p1BUTTON3) then
			p1BUTTON3 = false
			if (iBullets > 0) then
			
				if (civillianHit(currentFrame - thisOffset) == true) then				
					
					getNags(NAG_FRIENDLYKILLED)	
					discSkipToFrame(nagFrameStart)					
					lvlState = lvlPlayNag
					
				elseif bNoMoreBonuses == false then
					
					local b1 = false
				
					if (currentFrame >= thisOffset + 244) and (currentFrame <= thisOffset + 860) then
				
						if mousex >= 208 and mousex <= 225 and mousey >= 181 and mousey <= 194 then
						
							b1 = true
						
						end
					
					elseif bonusHit(currentFrame - thisOffset) then
					
						b1 = true
						
					end
					
					if b1 then 
					
						iBullets = 13
						bNoMoreBonuses = true
						playMe(sndBonus)
						
					end	
					
				end
			
			end
			
		end
		
	elseif (lvlState == lvlPlayDeath) then
	
		if (currentFrame == move[currentMove][deathFrameEnd]) then
		
			if (move[currentMove][rndMoveType] == GOODGUY) then
			
				getNags(NAG_FRIENDLYKILLED)
				
			else
			
				getNags(NAG_NORMAL)			
				
			end
			discSkipToFrame(nagFrameStart)
			lvlState = lvlPlayNag	
			
		end
		
	elseif (lvlState == lvlPlayNag) then
	
		if (currentFrame == nagFrameEnd or p1BUTTON3) then
		
			p1BUTTON3 = false		
			lvlState = lvlEnd
		
		end	
	
	elseif (lvlState == lvlEnd) then
	
		lvlState = lvlSetup
		if (iLives == 0) then --Game Over 
			
			tempLevel = currentLevel		
			currentLevel = levelContinue
			
		elseif (iLives > 0 and dip_Undertaker == false and not bLevelComplete) then
			
			tempLevel = currentLevel
			currentLevel = levelLivesLeft			
			
		else
			
			if bLevelComplete then			
				
				stage[levelHarry1] = true				
				bSection01Reached = false
				currentLevel = levelHarry2
				bShowdown = true
				
			else
				currentLevel = levelMenu
				
			end
			
			
		end

		if bDebug then debugPrint ("Leaving doLevelHarry1()") end
	
	end

end

function doLevelHarry2()

	if (lvlState == lvlSetup) then
	
		if bDebug then debugPrint ("Entering doLevelHarry2()") end
	
		setupLevel(levelHarry2)
		bLevelComplete = false
		levelFrameStart = thisOffset + 877
		levelFrameEnd   = thisOffset + 1924	
		bNoMoreBonuses = false

		currentMove = 1
		lvlState = lvlPlayClip1
		discSkipToFrame(offsetMenus + 1210)	
		
	elseif (lvlState == lvlPlayClip1) then -- Plays interstitial.
		
		if (currentFrame == offsetMenus + 1360) then
		
			discSkipToFrame(levelFrameStart)
			lvlState = lvlRunning
		
		end
		
	elseif (lvlState == lvlPlayClip2) then
		
		if (currentFrame == move[currentMove][rndMoveEnd]) then
			
			currentMove = currentMove + 1
			
			if (currentMove == 7) then  -- End of level reached
			
				bLevelComplete = true
				lvlState = lvlEnd
			
			else
			
				if (currentMove == 8) then
			
					currentMove = 3
					discSkipToFrame(move[currentMove][rndMoveStart])
			
				elseif (currentMove <= totalMoves) then
				
					discSkipToFrame(move[currentMove][rndMoveStart])
				
				end				
				
				lvlState = lvlRunning
				
			end
			
		elseif (p1BUTTON3) then
			p1BUTTON3 = false
			if (iBullets > 0) then
			
				if (civillianHit(currentFrame - thisOffset) == true) then

						getNags(NAG_FRIENDLYKILLED)	
						discSkipToFrame(nagFrameStart)					
						lvlState = lvlPlayNag
						
				elseif bNoMoreBonuses == false then
					
					local b1 = false
				
					if (currentFrame >= thisOffset + 1270) and (currentFrame <= thisOffset + 1485) then
				
						if mousex >= 74 and mousex <= 82 and mousey >= 46 and mousey <= 59 then
						
							b1 = true
							
						end
						
					elseif bonusHit(currentFrame - thisOffset) then
					
						b1 = true
						
					end
					
					if b1 then 
					
						iBullets = 13
						bNoMoreBonuses = true
						playMe(sndBonus)
						
					end	
					
				end
			
			end
		
		end
		
	elseif (lvlState == lvlPause) then
		
		if timerDue() then
		
			discSkipToFrame(move[currentMove][deathFrameStart])				
			lvlState = lvlPlayDeath	
			
		else
		
			if (p1BUTTON3) then
				p1BUTTON3 = false
				if (iBullets > 0) then
				
					if (shooterHit(currentFrame - thisOffset, currentMove) == true) then -- Bad guy Hit!
					
						iScore = iScore + SCORE_BADGUY
						discSkipToFrame(move[currentMove][moveFrameEnd]+1)
						lvlState = lvlPlayClip2
						
					elseif (civillianHit(currentFrame - thisOffset) == true) then					
						
						if (currentMove == 1) then						
							
							move[currentMove][deathFrameStart] = 32620
							move[currentMove][deathFrameEnd] = 32677
							move[currentMove][rndMoveType] = GOODGUY
						
						end
						
						discSkipToFrame(move[currentMove][deathFrameStart])				
						lvlState = lvlPlayDeath	
						
					end				
				
				end				
				
			end
		
		end
	
	elseif (lvlState == lvlRunning) then
	
		if (currentMove > totalMoves) then
		
			bLevelComplete = true
			lvlState = lvlEnd
			
		elseif (currentFrame > move[currentMove][moveFrameEnd]) then -- Death to player!
		
			if (move[currentMove][rndMoveType] == GOODGUY) then
			
				lvlState = lvlPlayClip2
				
			elseif (currentMove == 1) then -- Special case. Dealer gets shot
			
				currentMove = 7
				discSkipToFrame(move[currentMove][rndMoveStart])
				lvlState = lvlRunning
				
			else
				
				discSkipToFrame(move[currentMove][moveFrameEnd])
				discPause()
				timerON(iDelay)
				lvlState = lvlPause
				
			end
		
		elseif (currentFrame >= move[currentMove][moveFrameStart] and currentFrame < move[currentMove][moveFrameEnd]) then
		
			if (p1BUTTON3) then
				p1BUTTON3 = false
				if (iBullets > 0) then
				
					if (shooterHit(currentFrame - thisOffset, currentMove) == true) then -- Bad guy Hit!
					
						iScore = iScore + SCORE_BADGUY
						discSkipToFrame(move[currentMove][moveFrameEnd]+1)
						lvlState = lvlPlayClip2
						
					elseif (civillianHit(currentFrame - thisOffset) == true) then					
					
						if (currentMove == 1) then						
							
							move[currentMove][deathFrameStart] = 32620
							move[currentMove][deathFrameEnd] = 32677
							move[currentMove][rndMoveType] = GOODGUY
						
						end
						
						discSkipToFrame(move[currentMove][deathFrameStart])				
						lvlState = lvlPlayDeath	
					
					elseif bNoMoreBonuses == false then
					
						local b1 = false
				
						if (currentFrame >= thisOffset + 1270) and (currentFrame <= thisOffset + 1485) then
					
							if mousex >= 74 and mousex <= 82 and mousey >= 46 and mousey <= 59 then
							
								b1 = true
								
							end
							
						elseif bonusHit(currentFrame - thisOffset) then
						
							b1 = true
							
						end
						
						if b1 then 
						
							iBullets = 13
							bNoMoreBonuses = true
							playMe(sndBonus)
							
						end	
					
					end				
				
				end				
				
			end
			
		elseif (p1BUTTON3) then
			p1BUTTON3 = false
			if (iBullets > 0) then
			
				if (civillianHit(currentFrame - thisOffset) == true) then				
					
					getNags(NAG_FRIENDLYKILLED)	
					discSkipToFrame(nagFrameStart)					
					lvlState = lvlPlayNag
					
				elseif bNoMoreBonuses == false then
					
					local b1 = false
				
					if (currentFrame >= thisOffset + 1270) and (currentFrame <= thisOffset + 1485) then
				
						if mousex >= 74 and mousex <= 82 and mousey >= 46 and mousey <= 59 then
						
							b1 = true
							
						end
						
					elseif bonusHit(currentFrame - thisOffset) then
					
						b1 = true
						
					end
					
					if b1 then 
					
						iBullets = 13
						bNoMoreBonuses = true
						playMe(sndBonus)
						
					end	
					
				end
			
			end
			
		end
		
	elseif (lvlState == lvlPlayDeath) then
	
		if (currentFrame == move[currentMove][deathFrameEnd]) then
		
			if (move[currentMove][rndMoveType] == GOODGUY) then
			
				getNags(NAG_FRIENDLYKILLED)
				
			else
			
				getNags(NAG_NORMAL)			
				
			end
			discSkipToFrame(nagFrameStart)
			lvlState = lvlPlayNag	
			
		end
		
	elseif (lvlState == lvlPlayNag) then
	
		if (currentFrame == nagFrameEnd or p1BUTTON3) then
		
			p1BUTTON3 = false		
			lvlState = lvlEnd
		
		end	
	
	elseif (lvlState == lvlEnd) then
	
		lvlState = lvlSetup
		if (iLives == 0) then --Game Over 
			
			tempLevel = currentLevel		
			currentLevel = levelContinue
			
		elseif (iLives > 0 and dip_Undertaker == false and not bLevelComplete) then
			
			tempLevel = currentLevel
			currentLevel = levelLivesLeft			
			
		else

			if bLevelComplete then
			
				local r
				local t
				--singeRandomize()
				--r, t = math.modf(math.random(10000,109999)/10000)
				r = rndegg:value(1, 10)
				
				if r > 5 then
				
					bHarryAlt = true
					currentLevel = levelHarry4
				
				else
					
					currentLevel = levelHarry3
				
				end			
				stage[levelHarry2] = true	
				bSection01Reached = false
				
			else
			
				currentLevel = levelMenu
				
			end
			
		end

		if bDebug then debugPrint ("Leaving doLevelHarry2()") end
	
	end

end

function doLevelHarry3()

	if (lvlState == lvlSetup) then
	
		if bDebug then debugPrint ("Entering doLevelHarry3()") end
	
		setupLevel(levelHarry3)
		levelFrameStart = thisOffset
		levelFrameEnd   = thisOffset + 2350
		bLevelComplete  = false		
		bNoMoreBonuses  = false
		
		if bSection01Reached then
		
			currentMove = 8
			discSkipToFrame(thisOffset + 1120)
			
		else
		
			currentMove = 1				
			discSkipToFrame(levelFrameStart)
		end
		
		lvlState = lvlRunning
		
	elseif (lvlState == lvlPlayClip1) then
	
		if (currentFrame == offsetMenus + 1098) then
		
			bLevelComplete = true
			iScore = iScore + SCORE_BOUNTY
			lvlState = lvlEnd
		
		end
		
	elseif (lvlState == lvlPause) then
	
		if timerDue() then
		
			discSkipToFrame(move[currentMove][deathFrameStart])				
			lvlState = lvlPlayDeath			
			
		else
		
			if (p1BUTTON3) then
				p1BUTTON3 = false
				if (iBullets > 0) then
				
					if (shooterHit(currentFrame - thisOffset, currentMove) == true) then -- Bad guy Hit!
						
						iScore = iScore + SCORE_BADGUY
						discSkipToFrame(move[currentMove][moveFrameEnd]+1)
						currentMove = currentMove + 1
						lvlState = lvlRunning
						
					elseif (civillianHit(currentFrame - thisOffset) == true) then						
					
						if (currentMove == 11) then
						
							iScore = iScore + SCORE_OUTLAW														
							panel[STAGE_HARRY] = CAPTURED
							discSkipToFrame(move[currentMove][moveFrameEnd]+1)
							currentMove = currentMove + 1
							lvlState = lvlRunning
						
						else
					
							discSkipToFrame(move[currentMove][deathFrameStart])				
							lvlState = lvlPlayDeath
							
						end		

					elseif bNoMoreBonuses == false then
					
						if bonusHit(currentFrame - thisOffset) then
						
							iBullets = 13
							bNoMoreBonuses = true
							playMe(sndBonus)
						
						end
					
					end	

					if currentMove == 8 then bSection01Reached = true end
					
				end
				
			end
		
		end
	
	elseif (lvlState == lvlRunning) then
	
		if (currentMove > totalMoves) then
		
			if (currentFrame == levelFrameEnd) then
				
				if panel[STAGE_HARRY] == DEAD and not bAdviceGiven then
				
					bAdviceGiven = true
					discSkipToFrame(offsetMenus + 952)
					lvlState = lvlPlayClip1
					
				else
				
					bLevelComplete = true
					iScore = iScore + SCORE_BOUNTY
					lvlState = lvlEnd
				
				end
	
			end
			
		elseif (currentFrame > move[currentMove][moveFrameEnd]) then -- Death to player!
		
			if (move[currentMove][rndMoveType] == GOODGUY) then
			
				currentMove = currentMove + 1
			else
			
				discSkipToFrame(move[currentMove][moveFrameEnd])
				discPause()			
				timerON(iDelay)
				lvlState = lvlPause			
				
			end
		
		elseif (currentFrame >= move[currentMove][moveFrameStart] and currentFrame < move[currentMove][moveFrameEnd]) then
		
			if (p1BUTTON3) then
				p1BUTTON3 = false
				if (iBullets > 0) then
				
					if (shooterHit(currentFrame - thisOffset, currentMove) == true) then -- Bad guy Hit!
					
						if (currentMove == 11) then							
							
							iScore = iScore + SCORE_OUTLAW * 0.5					
							discSkipToFrame(35760)
							levelFrameEnd   = 35998
							totalMoves = 11
							panel[STAGE_HARRY] = DEAD						
						
						else
					
							iScore = iScore + SCORE_BADGUY
							discSkipToFrame(move[currentMove][moveFrameEnd]+1)							
							
						end
						currentMove = currentMove + 1
						if currentMove == 8 then bSection01Reached = true end
						if currentMove == 2 or currentMove == 4 or currentMove == 8 then bNoMoreBonuses = false end
						
					elseif (civillianHit(currentFrame - thisOffset) == true) then						
					
						if (currentMove == 11) then
						
							iScore = iScore + SCORE_OUTLAW														
							panel[STAGE_HARRY] = CAPTURED
							discSkipToFrame(move[currentMove][moveFrameEnd]+1)
							currentMove = currentMove + 1							
						
						else
					
							discSkipToFrame(move[currentMove][deathFrameStart])				
							lvlState = lvlPlayDeath
							
						end
					
					elseif bNoMoreBonuses == false then
					
						if bonusHit(currentFrame - thisOffset) then
						
							iBullets = 13
							bNoMoreBonuses = true
							playMe(sndBonus)
						
						end
					
					end
				
				end				
				
			end
			
		else
		
			if (p1BUTTON3) then
				p1BUTTON3 = false
				if bNoMoreBonuses == false then
					
					if bonusHit(currentFrame - thisOffset) then
					
						iBullets = 13
						bNoMoreBonuses = true
						playMe(sndBonus)
					
					end
					
				end
				
			end
			
		end
		
	elseif (lvlState == lvlPlayDeath) then
	
		if (currentFrame == move[currentMove][deathFrameEnd]) then
		
			if (move[currentMove][rndMoveType] == GOODGUY) then
			
				getNags(NAG_FRIENDLYKILLED)
				
			else
			
				getNags(NAG_NORMAL)
				
			end
			discSkipToFrame(nagFrameStart)
			lvlState = lvlPlayNag			
				
		
		end
		
	elseif (lvlState == lvlPlayNag) then
	
		if (currentFrame == nagFrameEnd or p1BUTTON3) then
		
			p1BUTTON3 = false		
			lvlState = lvlEnd
		
		end	
	
	elseif (lvlState == lvlEnd) then
	
		lvlState = lvlSetup
		if (iLives == 0) then --Game Over 
			
			tempLevel = currentLevel		
			currentLevel = levelContinue
			
		elseif (iLives > 0 and dip_Undertaker == false and not bLevelComplete) then
			
			tempLevel = currentLevel
			currentLevel = levelLivesLeft			
			
		else
			
			if bLevelComplete or currentMove >= totalMoves then  -- Special case. After capturing Harry there is one more move.
																 -- This is to avoid capturing Harry multiple times if player misses last move.
				
				stage[levelHarry3] = true
				currentLevel = levelMenu
				bSection01Reached = false
				
			else
			
				currentLevel = levelMenu
				
			end			
			

		end

		if bDebug then debugPrint ("Leaving doLevelHarry3()") end
	
	end

end

function doLevelHarry4()

	if (lvlState == lvlSetup) then
	
		if bDebug then debugPrint ("Entering doLevelHarry4()") end
	
		setupLevel(levelHarry4)
		bLevelComplete = false
		bNoMoreBonuses = false
		levelFrameStart = thisOffset 
		levelFrameEnd   = thisOffset + 1229	

		if bSection01Reached then
			currentMove = 10
			lvlState = lvlRunning
			discSkipToFrame(move[currentMove][rndMoveStart])	
		else
			currentMove = 1
			lvlState = lvlPlayClip1
			discSkipToFrame(levelFrameStart)	
			
		end
		
	elseif (lvlState == lvlPlayClip1) then
	
		if (currentFrame == thisOffset + 149) then
		
			lvlState = lvlRunning
			discSkipToFrame(move[currentMove][rndMoveStart])
			
		elseif p1BUTTON3 then
		
			p1BUTTON3 = false
			if bNoMoreBonuses == false then
	
				if (currentFrame >= thisOffset) and (currentFrame <= thisOffset + 1200) then
			
					if mousex >= 299 and mousex <= 306 and mousey >= 176 and mousey <= 185 then

						iBullets = 13
						bNoMoreBonuses = true
						playMe(sndBonus)
						
					end					
					
				end
				
			end
		
		end
		
	elseif (lvlState == lvlPlayClip2) then
		
		if (currentFrame == move[currentMove][rndMoveEnd]) then
			
			currentMove = currentMove + 1
			
			if (currentMove <= totalMoves) then
				
				discSkipToFrame(move[currentMove][rndMoveStart])
			
			end
			
			lvlState = lvlRunning
			
		elseif (p1BUTTON3) then
			p1BUTTON3 = false
			if (iBullets > 0) then
			
				if (civillianHit(currentFrame - thisOffset) == true) then

						getNags(NAG_FRIENDLYKILLED)	
						discSkipToFrame(nagFrameStart)					
						lvlState = lvlPlayNag
						
				elseif bNoMoreBonuses == false then
					
					if (currentFrame >= thisOffset) and (currentFrame <= thisOffset + 1200) then

						if mousex >= 299 and mousex <= 306 and mousey >= 176 and mousey <= 185 then

							iBullets = 13
							bNoMoreBonuses = true
							playMe(sndBonus)
							
						end					
						
					end
					
				end
			
			end
		
		end
		
	elseif (lvlState == lvlPlayClip3) then
	
		if (currentFrame == levelFrameEnd) then
		
			bLevelComplete = true
			lvlState = lvlEnd
		
		end
		
	elseif (lvlState == lvlPause) then
		
		if timerDue() then
		
			discSkipToFrame(move[currentMove][deathFrameStart])				
			lvlState = lvlPlayDeath	
			
		else
		
			if (p1BUTTON3) then
				p1BUTTON3 = false
				if (iBullets > 0) then
				
					if (shooterHit(currentFrame - thisOffset, currentMove) == true) then -- Bad guy Hit!
					
						iScore = iScore + SCORE_BADGUY
						discSkipToFrame(move[currentMove][moveFrameEnd]+1)
						lvlState = lvlPlayClip2
						
					elseif (civillianHit(currentFrame - thisOffset) == true) then					
						
						if (move[currentMove][deathFrameStart] == 37228) then
						
							move[currentMove][deathFrameStart] = 37297
							move[currentMove][deathFrameEnd] = 37370
							move[currentMove][rndMoveType] = GOODGUY							
							
						end
						
						discSkipToFrame(move[currentMove][deathFrameStart])				
						lvlState = lvlPlayDeath	
					
					end				
				
				end				
				
			end
		
		end
	
	elseif (lvlState == lvlRunning) then
	
		if (currentMove > totalMoves) then
		
			discSkipToFrame(thisOffset + 1215)
			lvlState = lvlPlayClip3
			
		elseif (currentFrame > move[currentMove][moveFrameEnd]) then -- Death to player!
		
			if (move[currentMove][rndMoveType] == GOODGUY) then
			
				lvlState = lvlPlayClip2		
			
			else
				
				discSkipToFrame(move[currentMove][moveFrameEnd])
				discPause()
				timerON(iDelay)
				lvlState = lvlPause
				
			end
		
		elseif (currentFrame >= move[currentMove][moveFrameStart] and currentFrame < move[currentMove][moveFrameEnd]) then
		
			if (p1BUTTON3) then
				p1BUTTON3 = false
				if (iBullets > 0) then
				
					if (shooterHit(currentFrame - thisOffset, currentMove) == true) then -- Bad guy Hit!
					
						iScore = iScore + SCORE_BADGUY
						discSkipToFrame(move[currentMove][moveFrameEnd]+1)
						lvlState = lvlPlayClip2
						
					elseif (civillianHit(currentFrame - thisOffset) == true) then						
						
						if (move[currentMove][deathFrameStart] == 37228) then
						
							move[currentMove][deathFrameStart] = 37297
							move[currentMove][deathFrameEnd] = 37370
							move[currentMove][rndMoveType] = GOODGUY							
							
						end
						
						discSkipToFrame(move[currentMove][deathFrameStart])				
						lvlState = lvlPlayDeath	
					
					elseif bNoMoreBonuses == false then
					
						if (currentFrame >= thisOffset) and (currentFrame <= thisOffset + 1200) then
					
							if mousex >= 299 and mousex <= 306 and mousey >= 176 and mousey <= 185 then

								iBullets = 13
								bNoMoreBonuses = true
								playMe(sndBonus)
								
							end					
							
						end
					
					end				
				
				end				
				
			end
			
		elseif (p1BUTTON3) then
			p1BUTTON3 = false
			if (iBullets > 0) then
			
				if (civillianHit(currentFrame - thisOffset) == true) then				
					
					getNags(NAG_FRIENDLYKILLED)	
					discSkipToFrame(nagFrameStart)					
					lvlState = lvlPlayNag
					
				elseif bNoMoreBonuses == false then
				
					if (currentFrame >= thisOffset) and (currentFrame <= thisOffset + 1200) then
				
						if mousex >= 299 and mousex <= 306 and mousey >= 176 and mousey <= 185 then

							iBullets = 13
							bNoMoreBonuses = true
							playMe(sndBonus)
							
						end					
						
					end
					
				end
			
			end
			
		end
		
	elseif (lvlState == lvlPlayDeath) then
	
		if (currentFrame == move[currentMove][deathFrameEnd]) then
		
			if (move[currentMove][rndMoveType] == GOODGUY) then
			
				getNags(NAG_FRIENDLYKILLED)
				
			else
			
				getNags(NAG_NORMAL)			
				
			end
			discSkipToFrame(nagFrameStart)
			lvlState = lvlPlayNag	
			
		end
		
	elseif (lvlState == lvlPlayNag) then
	
		if (currentFrame == nagFrameEnd or p1BUTTON3) then
		
			p1BUTTON3 = false		
			lvlState = lvlEnd
		
		end		
	
	elseif (lvlState == lvlEnd) then
	
		lvlState = lvlSetup
		if (iLives == 0) then --Game Over 
			
			tempLevel = currentLevel		
			currentLevel = levelContinue
			
		elseif (iLives > 0 and dip_Undertaker == false and not bLevelComplete) then
			
			tempLevel = currentLevel
			currentLevel = levelLivesLeft			
			
		else
			
			if bLevelComplete then			
				
				stage[levelHarry4] = true				
				bSection01Reached = false
				currentLevel = levelHarry3
				
			else
				currentLevel = levelMenu			
			end
			
		end

		if bDebug then debugPrint ("Leaving doLevelHarry4()") end
	
	end

end

function doLevelLoco1()

	if (lvlState == lvlSetup) then
	
		if bDebug then debugPrint ("Entering doLevelLoco1()") end
	
		setupLevel(levelLoco1)
		levelFrameStart = thisOffset
		levelFrameEnd   = thisOffset + 1060
		bLevelComplete  = false		
		bNoMoreBonuses  = false
		
		currentMove = 1				
		setupClip(offsetMenus + 3580, offsetMenus + 3680)
		lvlState = lvlPlayClip3
		
	elseif (lvlState == lvlPlayClip1) then
	
		if currentFrame == levelFrameEnd then
		
			bLevelComplete = true			
			lvlState = lvlEnd
		
		end		
		
	elseif (lvlState == lvlPlayClip2) then
	
		if (currentFrame == move[currentMove][rndMoveEnd]) then
			
			currentMove = currentMove + 1
			
			if (currentMove <= totalMoves) then
				
				discSkipToFrame(move[currentMove][rndMoveStart])
				
			end
				
			lvlState = lvlRunning
			
		elseif (p1BUTTON3) then
			p1BUTTON3 = false
			if (iBullets > 0) then
			
				if bNoMoreBonuses == false then
					
					local b1 = false
				
					if (currentFrame >= thisOffset + 12) and (currentFrame <= thisOffset + 450) then
				
						if mousex >= 188 and mousex <= 197 and mousey >= 99 and mousey <= 109 then
						
							b1 = true
						
						end					
						
					elseif bonusHit(currentFrame - thisOffset) then
					
						b1 = true
						
					end
					
					if b1 then 
					
						iBullets = 13
						bNoMoreBonuses = true
						playMe(sndBonus)
						
					end
					
				end
			
			end
		
		end
	
	elseif (lvlState == lvlPlayClip3) then
	
		if (currentFrame == iFrameEnd) then
		
			discSkipToFrame(levelFrameStart)		
			lvlState = lvlRunning
			
		end
		
	elseif (lvlState == lvlPause) then
	
		if timerDue() then
		
			discSkipToFrame(move[currentMove][deathFrameStart])				
			lvlState = lvlPlayDeath			
			
		else
		
			if (p1BUTTON3) then
				p1BUTTON3 = false
				if (iBullets > 0) then
				
					if (shooterHit(currentFrame - thisOffset, currentMove) == true) then -- Bad guy Hit!
						
						iScore = iScore + SCORE_BADGUY
						discSkipToFrame(move[currentMove][moveFrameEnd]+1)
						lvlState = lvlPlayClip2
					
					end	

				end
				
			end
		
		end
	
	elseif (lvlState == lvlRunning) then
	
		if (currentMove > totalMoves) then
		
			discSkipToFrame(thisOffset + 751)
			lvlState = lvlPlayClip1
	
		elseif (currentFrame > move[currentMove][moveFrameEnd]) then -- Death to player!
		
			if (move[currentMove][rndMoveType] == GOODGUY) then
			
				lvlState = lvlPlayClip2
				
			else
			
				discSkipToFrame(move[currentMove][moveFrameEnd])
				discPause()			
				timerON(iDelay)
				lvlState = lvlPause			
				
			end
		
		elseif (currentFrame >= move[currentMove][moveFrameStart] and currentFrame < move[currentMove][moveFrameEnd]) then
		
			if (p1BUTTON3) then
				p1BUTTON3 = false
				if (iBullets > 0) then
				
					if (shooterHit(currentFrame - thisOffset, currentMove) == true) then -- Bad guy Hit!
					
						iScore = iScore + SCORE_BADGUY
						discSkipToFrame(move[currentMove][moveFrameEnd]+1)		
						
						lvlState = lvlPlayClip2
						
					elseif (civillianHit(currentFrame - thisOffset) == true) then						
					
						discSkipToFrame(move[currentMove][deathFrameStart])				
						lvlState = lvlPlayDeath
					
					elseif bNoMoreBonuses == false then
					
						local b1 = false
				
						if (currentFrame >= thisOffset + 12) and (currentFrame <= thisOffset + 450) then
				
							if mousex >= 188 and mousex <= 197 and mousey >= 99 and mousey <= 109 then
							
								b1 = true
							
							end					
							
						elseif bonusHit(currentFrame - thisOffset) then
						
							b1 = true
							
						end
						
						if b1 then 
						
							iBullets = 13
							bNoMoreBonuses = true
							playMe(sndBonus)
							
						end
					
					end
				
				end				
				
			end
			
		else
		
			if (p1BUTTON3) then
				p1BUTTON3 = false
				if bNoMoreBonuses == false then
					
					if bonusHit(currentFrame - thisOffset) then
					
						iBullets = 13
						bNoMoreBonuses = true
						playMe(sndBonus)
					
					end
					
				end
				
			end
			
		end
		
	elseif (lvlState == lvlPlayDeath) then
	
		if (currentFrame == move[currentMove][deathFrameEnd]) then
		
			if (move[currentMove][rndMoveType] == GOODGUY) then
			
				getNags(NAG_FRIENDLYKILLED)
				
			else
			
				getNags(NAG_NORMAL)
				
			end
			discSkipToFrame(nagFrameStart)
			lvlState = lvlPlayNag			
				
		
		end
		
	elseif (lvlState == lvlPlayNag) then
	
		if (currentFrame == nagFrameEnd or p1BUTTON3) then
		
			p1BUTTON3 = false		
			lvlState = lvlEnd
		
		end	
	
	elseif (lvlState == lvlEnd) then
	
		lvlState = lvlSetup
		if (iLives == 0) then --Game Over 
			
			tempLevel = currentLevel		
			currentLevel = levelContinue
			
		elseif (iLives > 0 and dip_Undertaker == false and not bLevelComplete) then
			
			tempLevel = currentLevel
			currentLevel = levelLivesLeft			
			
		else
			
			if bLevelComplete then			
				
				stage[levelLoco1] = true
				currentLevel = levelLoco2
				bSection01Reached = false
				bShowdown = true
				
			else
			
				currentLevel = levelMenu
				
			end			
			

		end

		if bDebug then debugPrint ("Leaving doLevelLoco1()") end
	
	end

end

function doLevelLoco2()

	if (lvlState == lvlSetup) then
	
		if bDebug then debugPrint ("Entering doLevelLoco2()") end
	
		setupLevel(levelLoco2)
		levelFrameStart = thisOffset + 1061
		levelFrameEnd   = thisOffset + 1975
		bLevelComplete  = false		
		bNoMoreBonuses  = false
		
		currentMove = 1				
		discSkipToFrame(levelFrameStart)		
		lvlState = lvlPlayClip1
		
	elseif (lvlState == lvlPlayClip1) then
	
		if currentFrame == thisOffset + 1257 then
		
			lvlState = lvlRunning
		
		elseif p1BUTTON3 then
		
			discSkipToFrame(thisOffset + 1257)		
			lvlState = lvlRunning
		
		end
		
	elseif (lvlState == lvlPause) then
	
		if timerDue() then
		
			discSkipToFrame(move[currentMove][deathFrameStart])				
			lvlState = lvlPlayDeath			
			
		else
		
			if (p1BUTTON3) then
				p1BUTTON3 = false
				if (iBullets > 0) then
				
					if (shooterHit(currentFrame - thisOffset, currentMove) == true) then -- Bad guy Hit!
						
						iScore = iScore + SCORE_BADGUY
						discSkipToFrame(move[currentMove][moveFrameEnd]+1)
						currentMove = currentMove + 1
						lvlState = lvlRunning
						
					elseif (civillianHit(currentFrame - thisOffset) == true) then						
					
						if currentMove == 7 then
						
							move[currentMove][deathFrameStart] = 20246
							move[currentMove][deathFrameEnd] = 20295
							move[currentMove][rndMoveType] = GOODGUY
						
						end
				
						discSkipToFrame(move[currentMove][deathFrameStart])				
						lvlState = lvlPlayDeath
					

					elseif bNoMoreBonuses == false then
					
						if bonusHit(currentFrame - thisOffset) then
						
							iBullets = 13
							bNoMoreBonuses = true
							playMe(sndBonus)
						
						end
					
					end	
					
				end
				
			end
		
		end
	
	elseif (lvlState == lvlRunning) then
	
		if (currentMove > totalMoves) then
		
			if (currentFrame == levelFrameEnd) then
	
				bLevelComplete = true				
				lvlState = lvlEnd
				
			end
			
		elseif (currentFrame > move[currentMove][moveFrameEnd]) then -- Death to player!
		
			if (move[currentMove][rndMoveType] == GOODGUY) then
			
				currentMove = currentMove + 1
			else
			
				discSkipToFrame(move[currentMove][moveFrameEnd])
				discPause()			
				timerON(iDelay)
				lvlState = lvlPause			
				
			end
		
		elseif (currentFrame >= move[currentMove][moveFrameStart] and currentFrame < move[currentMove][moveFrameEnd]) then
		
			if (p1BUTTON3) then
				p1BUTTON3 = false
				if (iBullets > 0) then
				
					if (shooterHit(currentFrame - thisOffset, currentMove) == true) then -- Bad guy Hit!
					
						iScore = iScore + SCORE_BADGUY
						discSkipToFrame(move[currentMove][moveFrameEnd]+1)
						currentMove = currentMove + 1
						
					elseif (civillianHit(currentFrame - thisOffset) == true) then						
					
						if currentMove == 7 then
						
							move[currentMove][deathFrameStart] = 20246
							move[currentMove][deathFrameEnd] = 20295
							move[currentMove][rndMoveType] = GOODGUY
						
						end
				
						discSkipToFrame(move[currentMove][deathFrameStart])				
						lvlState = lvlPlayDeath
					
					elseif bNoMoreBonuses == false then
					
						if bonusHit(currentFrame - thisOffset) then
						
							iBullets = 13
							bNoMoreBonuses = true
							playMe(sndBonus)
						
						end
					
					end
				
				end				
				
			end
			
		else
		
			if (p1BUTTON3) then
				p1BUTTON3 = false
				if bNoMoreBonuses == false then
					
					if bonusHit(currentFrame - thisOffset) then
					
						iBullets = 13
						bNoMoreBonuses = true
						playMe(sndBonus)
					
					end
					
				end
				
			end
			
		end
		
	elseif (lvlState == lvlPlayDeath) then
	
		if (currentFrame == move[currentMove][deathFrameEnd]) then
		
			if (move[currentMove][rndMoveType] == GOODGUY) then
			
				getNags(NAG_FRIENDLYKILLED)
				
			else
			
				getNags(NAG_NORMAL)
				
			end
			discSkipToFrame(nagFrameStart)
			lvlState = lvlPlayNag			
				
		
		end
		
	elseif (lvlState == lvlPlayNag) then
	
		if (currentFrame == nagFrameEnd or p1BUTTON3) then
		
			p1BUTTON3 = false		
			lvlState = lvlEnd
		
		end	
	
	elseif (lvlState == lvlEnd) then
	
		lvlState = lvlSetup
		if (iLives == 0) then --Game Over 
			
			tempLevel = currentLevel		
			currentLevel = levelContinue
			
		elseif (iLives > 0 and dip_Undertaker == false and not bLevelComplete) then
			
			tempLevel = currentLevel
			currentLevel = levelLivesLeft			
			
		else
			
			if bLevelComplete then			
				
				stage[levelLoco2] = true
				bSection01Reached = false
				local r = rndegg:value(1, 10)
				
				
				if r > 5 then
				
					bLocoAlt = true
					currentLevel = levelLoco4
				
				else
					
					currentLevel = levelLoco3
				
				end	
				
			else
			
				currentLevel = levelMenu
				
			end			
			

		end

		if bDebug then debugPrint ("Leaving doLevelLoco2()") end
	
	end

end

function doLevelLoco3()

	if (lvlState == lvlSetup) then
	
		if bDebug then debugPrint ("Entering doLevelLoco3()") end
	
		setupLevel(levelLoco3)
		levelFrameStart = thisOffset 
		levelFrameEnd   = thisOffset + 2534
		bLevelComplete  = false		
		bNoMoreBonuses  = false
		
		if bSection01Reached and not bSection02Reached then
		
			currentMove = 8
			discSkipToFrame(thisOffset + 470)
			
		elseif bSection02Reached then
		
			currentMove = 13
			discSkipToFrame(thisOffset + 1024)
			
		else
		
			currentMove = 1				
			discSkipToFrame(levelFrameStart)		
			
		end
		lvlState = lvlRunning
		
		--for debugging purposes
		--currentMove = 17
		--discSkipToFrame(thisOffset + 1616)
		
	elseif (lvlState == lvlPlayClip1) then
	
		if (currentFrame == offsetMenus + 1098) then
		
			bLevelComplete = true
			iScore = iScore + SCORE_BOUNTY
			lvlState = lvlEnd
		
		end
	
	elseif (lvlState == lvlPause) then
	
		if timerDue() then
		
			discSkipToFrame(move[currentMove][deathFrameStart])				
			lvlState = lvlPlayDeath			
			
		else
		
			if (p1BUTTON3) then
				p1BUTTON3 = false
				if (iBullets > 0) then
				
					if (shooterHit(currentFrame - thisOffset, currentMove) == true) then -- Bad guy Hit!
						
						if currentMove == 18 then
						
							iScore = iScore + SCORE_OUTLAW * 0.5					
							discSkipToFrame(move[currentMove][moveFrameEnd]+1)
							levelFrameEnd   = thisOffset + 2534
							totalMoves = 16
							panel[STAGE_LOCO] = DEAD							
						
						else
					
							iScore = iScore + SCORE_BADGUY
							discSkipToFrame(move[currentMove][moveFrameEnd]+1)
							currentMove = currentMove + 1
							if currentMove == 8 then bSection01Reached = true end
							if currentMove == 13 then bSection02Reached = true end
							
						end
						lvlState = lvlRunning
						
					elseif (civillianHit(currentFrame - thisOffset) == true) then						
					
						discSkipToFrame(move[currentMove][deathFrameStart])				
						lvlState = lvlPlayDeath
					

					elseif bNoMoreBonuses == false then
					
						if bonusHit(currentFrame - thisOffset) then
						
							iBullets = 13
							bNoMoreBonuses = true
							playMe(sndBonus)
						
						end
					
					end	
					
				end
				
			end
		
		end
	
	elseif (lvlState == lvlRunning) then
	
		if (currentMove > totalMoves) then
		
			if (currentFrame == levelFrameEnd) then
			
				if panel[STAGE_LOCO] == DEAD and not bAdviceGiven then
				
					bAdviceGiven = true
					discSkipToFrame(offsetMenus + 952)
					lvlState = lvlPlayClip1
					
				else
	
					bLevelComplete = true				
					lvlState = lvlEnd
					
				end
				
			end
			
		elseif (currentFrame > move[currentMove][moveFrameEnd]) then -- Death to player!
		
			if (move[currentMove][rndMoveType] == GOODGUY) then
			
				currentMove = currentMove + 1
				
			elseif currentMove == 17 then
			
				currentMove = 18
				discSkipToFrame(thisOffset + 2017)				
				lvlState = lvlRunning				
			
			else
			
				discSkipToFrame(move[currentMove][moveFrameEnd])
				discPause()			
				timerON(iDelay)
				lvlState = lvlPause			
				
			end
		
		elseif (currentFrame >= move[currentMove][moveFrameStart] and currentFrame < move[currentMove][moveFrameEnd]) then
		
			if (p1BUTTON3) then
				p1BUTTON3 = false
				if (iBullets > 0) then
				
					if (shooterHit(currentFrame - thisOffset, currentMove) == true) then -- Bad guy Hit!
					
						if currentMove == 17 then
						
							iScore = iScore + SCORE_OUTLAW 					
							discSkipToFrame(move[currentMove][moveFrameEnd]+1)
							levelFrameEnd   = thisOffset + 2016
							totalMoves = 16
							panel[STAGE_LOCO] = CAPTURED
							
						elseif currentMove == 18 then
						
							iScore = iScore + SCORE_OUTLAW * 0.5					
							discSkipToFrame(move[currentMove][moveFrameEnd]+1)
							levelFrameEnd   = thisOffset + 2534
							totalMoves = 16
							panel[STAGE_LOCO] = DEAD
						
						else
					
							iScore = iScore + SCORE_BADGUY
							discSkipToFrame(move[currentMove][moveFrameEnd]+1)
							currentMove = currentMove + 1
							if currentMove == 8 then bSection01Reached = true end
							if currentMove == 13 then bSection02Reached = true end
							
						end
						
					elseif (civillianHit(currentFrame - thisOffset) == true) then	
					
						discSkipToFrame(move[currentMove][deathFrameStart])				
						lvlState = lvlPlayDeath
					
					elseif bNoMoreBonuses == false then
					
						if bonusHit(currentFrame - thisOffset) then
						
							iBullets = 13
							bNoMoreBonuses = true
							playMe(sndBonus)
						
						end
					
					end
				
				end				
				
			end
			
		else
		
			if (p1BUTTON3) then
				p1BUTTON3 = false
				if bNoMoreBonuses == false then
					
					if bonusHit(currentFrame - thisOffset) then
					
						iBullets = 13
						bNoMoreBonuses = true
						playMe(sndBonus)
					
					end
					
				end
				
			end
			
		end
		
	elseif (lvlState == lvlPlayDeath) then
	
		if (currentFrame == move[currentMove][deathFrameEnd]) then
		
			if (move[currentMove][rndMoveType] == GOODGUY) then
			
				getNags(NAG_FRIENDLYKILLED)
				
			else
			
				getNags(NAG_NORMAL)
				
			end
			discSkipToFrame(nagFrameStart)
			lvlState = lvlPlayNag			
				
		
		end
		
	elseif (lvlState == lvlPlayNag) then
	
		if (currentFrame == nagFrameEnd or p1BUTTON3) then
		
			p1BUTTON3 = false		
			lvlState = lvlEnd
		
		end	
	
	elseif (lvlState == lvlEnd) then
	
		lvlState = lvlSetup
		if (iLives == 0) then --Game Over 
			
			tempLevel = currentLevel		
			currentLevel = levelContinue
			
		elseif (iLives > 0 and dip_Undertaker == false and not bLevelComplete) then
			
			tempLevel = currentLevel
			currentLevel = levelLivesLeft			
			
		else
			
			if bLevelComplete then			
				
				stage[levelLoco3] = true
				currentLevel = levelMenu
				bSection01Reached = false
				bSection02Reached = false
				
			end
			
			currentLevel = levelMenu

		end

		if bDebug then debugPrint ("Leaving doLevelLoco3()") end
	
	end

end

function doLevelLoco4()

	if (lvlState == lvlSetup) then
	
		if bDebug then debugPrint ("Entering doLevelLoco4()") end
	
		setupLevel(levelLoco4)
		levelFrameStart = thisOffset
		levelFrameEnd   = thisOffset + 603
		bLevelComplete  = false		
		bNoMoreBonuses  = false
		
		currentMove = 1				
		discSkipToFrame(levelFrameStart)
		
		lvlState = lvlRunning	
		
	elseif (lvlState == lvlPlayClip2) then
	
		if (currentFrame == move[currentMove][rndMoveEnd]) then
			
			currentMove = currentMove + 1
			
			if (currentMove <= totalMoves) then
				
				discSkipToFrame(move[currentMove][rndMoveStart])
				
			end
			
			lvlState = lvlRunning
			
		elseif (p1BUTTON3) then
			p1BUTTON3 = false
			if (iBullets > 0) then
			
				if bNoMoreBonuses == false then
					
					local b1 = false
				
					if (currentFrame >= thisOffset + 15) and (currentFrame <= thisOffset + 603) then
				
						if (mousex >= 143 and mousex <= 149 and mousey >= 113 and mousey <= 128) then
						
							b1 = true
							
						elseif (mousex >= 274 and mousex <= 281 and mousey >= 128 and mousey <= 138) then
						
							b1 = true
						
						end					
						
					elseif bonusHit(currentFrame - thisOffset) then
					
						b1 = true
						
					end
					
					if b1 then 
					
						iBullets = 13
						bNoMoreBonuses = true
						playMe(sndBonus)
						
					end
					
				end
			
			end
		
		end	
		
	elseif (lvlState == lvlPause) then
	
		if timerDue() then
		
			discSkipToFrame(move[currentMove][deathFrameStart])				
			lvlState = lvlPlayDeath			
			
		else
		
			if (p1BUTTON3) then
				p1BUTTON3 = false
				if (iBullets > 0) then
				
					if (shooterHit(currentFrame - thisOffset, currentMove) == true) then -- Bad guy Hit!
						
						iScore = iScore + SCORE_BADGUY
						discSkipToFrame(move[currentMove][moveFrameEnd]+1)
						lvlState = lvlPlayClip2
					
					end	

				end
				
			end
		
		end
	
	elseif (lvlState == lvlRunning) then
	
		if (currentMove > totalMoves) then
		
			bLevelComplete = true
			lvlState = lvlEnd
	
		elseif (currentFrame > move[currentMove][moveFrameEnd]) then -- Death to player!
		
			if (move[currentMove][rndMoveType] == GOODGUY) then
			
				lvlState = lvlPlayClip2
				
			else
			
				discSkipToFrame(move[currentMove][moveFrameEnd])
				discPause()			
				timerON(iDelay)
				lvlState = lvlPause			
				
			end
		
		elseif (currentFrame >= move[currentMove][moveFrameStart] and currentFrame < move[currentMove][moveFrameEnd]) then
		
			if (p1BUTTON3) then
				p1BUTTON3 = false
				if (iBullets > 0) then
				
					if (shooterHit(currentFrame - thisOffset, currentMove) == true) then -- Bad guy Hit!
					
						iScore = iScore + SCORE_BADGUY
						discSkipToFrame(move[currentMove][moveFrameEnd]+1)		
						
						lvlState = lvlPlayClip2
						
					elseif (civillianHit(currentFrame - thisOffset) == true) then						
					
						discSkipToFrame(move[currentMove][deathFrameStart])				
						lvlState = lvlPlayDeath
					
					elseif bNoMoreBonuses == false then
					
						local b1 = false
				
						if (currentFrame >= thisOffset + 12) and (currentFrame <= thisOffset + 450) then
				
							if (mousex >= 143 and mousex <= 149 and mousey >= 113 and mousey <= 128) then
						
								b1 = true
								
							elseif (mousex >= 274 and mousex <= 281 and mousey >= 128 and mousey <= 138) then
							
								b1 = true
							
							end						
							
						elseif bonusHit(currentFrame - thisOffset) then
						
							b1 = true
							
						end
						
						if b1 then 
						
							iBullets = 13
							bNoMoreBonuses = true
							playMe(sndBonus)
							
						end
					
					end
				
				end				
				
			end
			
		else
		
			if (p1BUTTON3) then
				p1BUTTON3 = false
				if bNoMoreBonuses == false then
					
					local b1 = false
			
					if (currentFrame >= thisOffset + 12) and (currentFrame <= thisOffset + 450) then
			
						if (mousex >= 143 and mousex <= 149 and mousey >= 113 and mousey <= 128) then
					
							b1 = true
						
						elseif (mousex >= 274 and mousex <= 281 and mousey >= 128 and mousey <= 138) then
						
							b1 = true
						
						end						
						
					elseif bonusHit(currentFrame - thisOffset) then
					
						b1 = true
						
					end
					
					if b1 then 
					
						iBullets = 13
						bNoMoreBonuses = true
						playMe(sndBonus)
						
					end
					
				end
				
			end
			
		end
		
	elseif (lvlState == lvlPlayDeath) then
	
		if (currentFrame == move[currentMove][deathFrameEnd]) then
		
			if (move[currentMove][rndMoveType] == GOODGUY) then
			
				getNags(NAG_FRIENDLYKILLED)
				
			else
			
				getNags(NAG_NORMAL)
				
			end
			discSkipToFrame(nagFrameStart)
			lvlState = lvlPlayNag			
				
		
		end
		
	elseif (lvlState == lvlPlayNag) then
	
		if (currentFrame == nagFrameEnd or p1BUTTON3) then
		
			p1BUTTON3 = false		
			lvlState = lvlEnd
		
		end		
	
	elseif (lvlState == lvlEnd) then
	
		lvlState = lvlSetup
		if (iLives == 0) then --Game Over 
			
			tempLevel = currentLevel		
			currentLevel = levelContinue
			
		elseif (iLives > 0 and dip_Undertaker == false and not bLevelComplete) then
			
			tempLevel = currentLevel
			currentLevel = levelLivesLeft			
			
		else
			
			if bLevelComplete then			
				
				stage[levelLoco4] = true
				currentLevel = levelLoco3
				bSection01Reached = false
				bShowdown = true
				bLocoAlt = false
				
			else
			
				currentLevel = levelMenu
				
			end			
			

		end

		if bDebug then debugPrint ("Leaving doLevelLoco4()") end
	
	end

end

function doLevelShowdown()

	if (lvlState == lvlSetup) then
		
		if bDebug then debugPrint("Entering doLevelShowdown()") end	
		
		local r
		local t
		
		--singeRandomize()
		--r, t = math.modf(math.random(10000,109999)/10000)
		
		r = rndegg:value(1,10)
		
		if (r > 7) and (not bJustStarting) then		
			
			bShowdown = false
			return true
			
		else
			bJustStarting = false
		
		end
		
		setupLevel(levelShowdown)		
		
		iBullets = 0
		bShowScore = true		
		bReloadDisabled = true
		bLevelComplete = false		
		currentMove = 1		
		discSkipToFrame (move[currentMove][rndMoveStart])	
		lvlState = lvlRunning
		
	elseif (lvlState == lvlPlayClip1) then
	
		if (currentFrame == move[currentMove][rndMoveEnd]) then 
			
			bLevelComplete = true		
			lvlState = lvlEnd		
			
		end
		
	elseif (lvlState == lvlPlayClip2) then
	
		if (currentFrame == move[currentMove][deathFrameEnd]) then
		
			iLives = iLives - 1
			iFrameStart = offsetTooEarlyClips + 104
			iFrameEnd = offsetTooEarlyClips + 220						
			discSkipToFrame(iFrameStart)
			lvlState = lvlPlayClip4			
		
		end
		
	elseif (lvlState == lvlPlayClip3) then
	
		if (currentFrame == move[currentMove][deathFrameEnd]) then
		
			iLives = iLives - 1
			iFrameStart = offsetTooEarlyClips
			iFrameEnd = offsetTooEarlyClips + 104						
			discSkipToFrame(iFrameStart)
			lvlState = lvlPlayClip4			
		
		end
		
	elseif (lvlState == lvlPlayClip4) then
	
		if currentFrame == iFrameEnd then
		
			lvlState = lvlEnd
		
		end
		
	elseif (lvlState == lvlPause) then
	
		if timerDue() then
		
			discSkipToFrame(move[currentMove][deathFrameStart])		
		
			if move[currentMove][rndMoveStart] >= SHOOTOUT09 and move[currentMove][rndMoveStart] <= SHOOTOUT11 then
			
				lvlState = lvlPlayClip3
			
			else
			
				
				lvlState = lvlPlayDeath
				
			end
		
		else
		
			if (p1BUTTON3) then						
				p1BUTTON3 = false
				if (iBullets > 0) then							
					
					if (shooterHit(currentFrame - thisOffset, 1) == true) then								
						
						iScore = iScore + SCORE_SHOWDOWN								
						discSkipToFrame(move[currentMove][moveFrameEnd]+1)					
						lvlState = lvlPlayClip1
					
					end
				
				end
			
			end		
		
		end	
		
	elseif (lvlState == lvlRunning) then
		
		if (currentMove > totalMoves) then 
			
			lvlState = lvlPlayClip1		
			
		else
			
			if (currentFrame == (move[currentMove][moveFrameStart] - 10)) then
		
				bReloadDisabled = false
				
			elseif (currentFrame > move[currentMove][moveFrameEnd]) then -- death to player!
		
				if not (dip_Difficulty == DOPT_EASY or dip_Difficulty == DOPT_MEDIUM) then  -- no pause on harder levels
				
					discSkipToFrame(move[currentMove][deathFrameStart])	
					lvlState = lvlPlayDeath
					
				else
				
					discSkipToFrame(move[currentMove][moveFrameEnd])
					discPause()					
					timerON(iDelay)
					lvlState = lvlPause
					
				end
				
			elseif (currentFrame >= move[currentMove][moveFrameStart] and currentFrame < move[currentMove][moveFrameEnd]) then
			
				if (p1BUTTON3) then						
					p1BUTTON3 = false
					if (iBullets > 0) then							
						
						if (shooterHit(currentFrame - thisOffset, 1) == true) then								
							
							iScore = iScore + SCORE_SHOWDOWN								
							discSkipToFrame(move[currentMove][moveFrameEnd]+1)
							
							lvlState = lvlPlayClip1
						
						end
					
					end
				
				end

			elseif (p1BUTTON3) then
			
				if move[currentMove][rndMoveStart] >= SHOOTOUT09 and move[currentMove][rndMoveStart] <= SHOOTOUT11 then
				
					if (currentFrame == (move[currentMove][moveFrameStart] - 5)) then  -- too early shot
						
						discSkipToFrame(move[currentMove][deathFrameStart])				
						lvlState = lvlPlayClip2	
					
					end				
				
				end
			
			end		
		
		end	
		
	elseif (lvlState == lvlPlayDeath) then
		
		if (currentFrame == move[currentMove][deathFrameEnd]) then			
			
			getNags(NAG_NORMAL)			
			lvlState = lvlPlayNag			
			discSkipToFrame(nagFrameStart)			
		
		end
		
	elseif (lvlState == lvlPlayNag) then
		
		if (currentFrame == nagFrameEnd or p1BUTTON3) then
		
			p1BUTTON3 = false		
			lvlState = lvlEnd
		
		end	
		
	elseif (lvlState == lvlEnd) then
		
		lvlState = lvlSetup
		if (iLives == 0) then --Game Over 
			
			tempLevel = currentLevel		
			currentLevel = levelContinue
			
		elseif (iLives > 0 and dip_Undertaker == false and not bLevelComplete) then
			
			tempLevel = currentLevel
			currentLevel = levelLivesLeft						
		
		end
		bShowdown = false
		
		if (bDebug) then debugPrint("Leaving doLevelShowdown()") end

	end

end

function doMenu()

	if (lvlState == lvlSetup) then
	
		if bDebug then debugPrint ("Entering doMenu()") end
		
		-- for debugging purposes
		--panel[STAGE_HARRY] = DEAD
		--panel[STAGE_DAN] = ATLARGE
		--panel[STAGE_LOCO] = CAPTURED
		--panel[STAGE_CACTUS] = ATLARGE
		
		if panel[STAGE_HARRY] > ATLARGE and panel[STAGE_DAN] > ATLARGE and panel[STAGE_LOCO] > ATLARGE and panel[STAGE_CACTUS] > ATLARGE then
		
			if not stage[levelFinal1] then
		
				currentLevel = levelFinal1
				
			else
				currentLevel = levelFinal2
				
			end
		
		else
		
			doMenuSelectClip2()
			GetArrayPanels()		
			
			discSkipToFrame(iFrameStart)			
			iChoice = 0		
			bShowScore = false			
			p1BUTTON3 = false
			lvlState = lvlRunning
			
		end		
		
	elseif (lvlState == lvlRunning) then	
		
		if currentFrame == iFrameEnd then
		
			if panel[STAGE_HARRY] == ATLARGE then
					
				if not stage[levelHarry1] then
			
					iChoice = levelHarry1
					
				elseif not stage[levelHarry2] then
			
					iChoice = levelHarry2
					
				elseif bHarryAlt then
			
					iChoice = levelHarry4
					
				elseif not stage[levelHarry3] then
			
					iChoice = levelHarry3
					
				end
				
			elseif panel[STAGE_DAN] == ATLARGE then
						
				if not stage[levelDan1] then
				
					iChoice = levelDan1
					
				elseif not stage[levelDan2] then
				
					iChoice = levelDan2
					
				elseif not stage[levelDan3] then
				
					iChoice = levelDan3
					
				end
				
			elseif panel[STAGE_LOCO] == ATLARGE then 
				
				if not stage[levelLoco1] then
			
					iChoice = levelLoco1
					
				elseif not stage[levelLoco2] then
			
					iChoice = levelLoco2
					
				elseif bLocoAlt then
			
					iChoice = levelLoco4
					
				elseif not stage[levelLoco3] then
			
					iChoice = levelLoco3
					
				end
			
			elseif panel[STAGE_CACTUS] == ATLARGE then 
						
				if not stage[levelCactus1] then
				
					iChoice = levelCactus1
					
				elseif not stage[levelCactus2] then
				
					iChoice = levelCactus2
					
				elseif not stage[levelCactus3] then
				
					iChoice = levelCactus3
					
				elseif not stage[levelCactus4] then
				
					iChoice = levelCactus4
					
				elseif not stage[levelCactus5] then
				
					iChoice = levelCactus5
					
				elseif not stage[levelCactus6] then
				
					iChoice = levelCactus6
					
				end
				
			end
				
			lvlState = lvlEnd		
			
		else
		
			if (p1BUTTON3) then
				
				p1BUTTON3 = false

				if (panelHit(STAGE_HARRY) == true) then
					
					if panel[STAGE_HARRY] == ATLARGE then
					
						if not stage[levelHarry1] then
					
							iChoice = levelHarry1
							
						elseif not stage[levelHarry2] then
					
							iChoice = levelHarry2
							
						elseif bHarryAlt then
					
							iChoice = levelHarry4
							
						elseif not stage[levelHarry3] then
					
							iChoice = levelHarry3
							
						end
						
						lvlState = lvlEnd
						
					end
				
				elseif (panelHit(STAGE_DAN) == true) then
					
					if panel[STAGE_DAN] == ATLARGE then
						
						if not stage[levelDan1] then
						
							iChoice = levelDan1
							
						elseif not stage[levelDan2] then
						
							iChoice = levelDan2
							
						elseif not stage[levelDan3] then
						
							iChoice = levelDan3
							
						end
						lvlState = lvlEnd	
						
					end
				
				elseif (panelHit(STAGE_LOCO) == true) then
					
					if panel[STAGE_LOCO] == ATLARGE then 
						
						if panel[STAGE_LOCO] == ATLARGE then
					
							if not stage[levelLoco1] then
						
								iChoice = levelLoco1
								
							elseif not stage[levelLoco2] then
						
								iChoice = levelLoco2
								
							elseif bLocoAlt then
						
								iChoice = levelLoco4
								
							elseif not stage[levelLoco3] then
						
								iChoice = levelLoco3
								
							end
							
							lvlState = lvlEnd
						
						end
						
					end
					
				elseif (panelHit(STAGE_CACTUS) == true) then
					
					if panel[STAGE_CACTUS] == ATLARGE then 
						
						if not stage[levelCactus1] then
						
							iChoice = levelCactus1
							
						elseif not stage[levelCactus2] then
						
							iChoice = levelCactus2
							
						elseif not stage[levelCactus3] then
						
							iChoice = levelCactus3
							
						elseif not stage[levelCactus4] then
						
							iChoice = levelCactus4
							
						elseif not stage[levelCactus5] then
						
							iChoice = levelCactus5
							
						elseif not stage[levelCactus6] then
						
							iChoice = levelCactus6
							
						end
						lvlState = lvlEnd
						
					end
					
				end
				
			else
			
				drawMenuOutlawState()
				
			end
		
		end	
	
	elseif (lvlState == lvlEnd) then
	
		lvlState = lvlSetup
		if not (iChoice == tempLevel) then
		
			bSection01Reached = false
			bSection02Reached = false
			bSection03Reached = false			
			
		end		
		currentLevel = iChoice
		tempLevel = iChoice
		bShowScore = true
		bNoMoreBonuses = false
		bShowdown = true
		
		if not (panel[STAGE_HARRY] == ATLARGE and panel[STAGE_DAN] == ATLARGE and panel[STAGE_LOCO] == ATLARGE and panel[STAGE_CACTUS] == ATLARGE) then		
		
			local r = 0
			local t = 0
			
			r,t = math.modf(clockRnd()/3)
			if (r == 1 and stage[levelBonus] == false) then 
			
				stage[levelBonus] = true  -- make the level play once ther game
				currentLevel = levelBonus 
				
			end		
			
		end
	
		if bDebug then debugPrint ("Leaving doMenu()") end
	
	end

end

function drawMenuOutlawState()

	if panel[STAGE_HARRY] == CAPTURED then
	
		spriteDraw(101,120,sprCaptured)
	
	elseif panel[STAGE_HARRY] == DEAD then
	
		spriteDraw(118,120,sprDead)
	
	end
	
	if panel[STAGE_DAN] == CAPTURED then
	
		spriteDraw(202,120,sprCaptured)
	
	elseif panel[STAGE_DAN] == DEAD then
	
		spriteDraw(215,120,sprDead)
	
	end
	
	if panel[STAGE_LOCO] == CAPTURED then
	
		spriteDraw(101,204,sprCaptured)
	
	elseif panel[STAGE_LOCO] == DEAD then
	
		spriteDraw(118,204,sprDead)
	
	end
	
	if panel[STAGE_CACTUS] == CAPTURED then

		spriteDraw(202,204,sprCaptured)
	
	elseif panel[STAGE_CACTUS] == DEAD then
	
		spriteDraw(215,204,sprDead)
	
	end

end

function doMenuSelectClip2()

	if bDebug then debugPrint ("Entering doMenuSelectClip2()") end	
	local thisOffset = 49713

	
	if panel[STAGE_HARRY] == ATLARGE and panel[STAGE_DAN] == ATLARGE and panel[STAGE_LOCO] == ATLARGE and panel[STAGE_CACTUS] == ATLARGE then
		
		iFrameStart = thisOffset
		iFrameEnd   = thisOffset + 318
		
	elseif panel[STAGE_HARRY] > ATLARGE and panel[STAGE_DAN] == ATLARGE and panel[STAGE_LOCO] == ATLARGE and panel[STAGE_CACTUS] == ATLARGE then
		
		iFrameStart = thisOffset + 318
		iFrameEnd   = thisOffset + 639
		
	elseif panel[STAGE_HARRY] == ATLARGE and panel[STAGE_DAN] > ATLARGE and panel[STAGE_LOCO] == ATLARGE and panel[STAGE_CACTUS] == ATLARGE then
		
		iFrameStart = thisOffset + 639
		iFrameEnd   = thisOffset + 958
		
	elseif panel[STAGE_HARRY] == ATLARGE and panel[STAGE_DAN] == ATLARGE and panel[STAGE_LOCO] > ATLARGE and panel[STAGE_CACTUS] == ATLARGE then
		
		iFrameStart = thisOffset + 958
		iFrameEnd   = thisOffset + 1278
		
	elseif panel[STAGE_HARRY] == ATLARGE and panel[STAGE_DAN] == ATLARGE and panel[STAGE_LOCO] == ATLARGE and panel[STAGE_CACTUS] > ATLARGE then
		
		iFrameStart = thisOffset + 1278
		iFrameEnd   = thisOffset + 1600
		
	end
	
	if panel[STAGE_HARRY] > ATLARGE and panel[STAGE_DAN] > ATLARGE and panel[STAGE_LOCO] == ATLARGE and panel[STAGE_CACTUS] == ATLARGE then
		
		iFrameStart = thisOffset + 1600
		iFrameEnd   = thisOffset + 1918
		
	elseif panel[STAGE_HARRY] > ATLARGE and panel[STAGE_DAN] == ATLARGE and panel[STAGE_LOCO] > ATLARGE and panel[STAGE_CACTUS] == ATLARGE then
		
		iFrameStart = thisOffset + 1918
		iFrameEnd   = thisOffset + 2238
		
	elseif panel[STAGE_HARRY] > ATLARGE and panel[STAGE_DAN] == ATLARGE and panel[STAGE_LOCO] == ATLARGE and panel[STAGE_CACTUS] > ATLARGE then
		
		iFrameStart = thisOffset + 2238
		iFrameEnd   = thisOffset + 2558
		
	elseif panel[STAGE_HARRY] == ATLARGE and panel[STAGE_DAN] > ATLARGE and panel[STAGE_LOCO] > ATLARGE and panel[STAGE_CACTUS] == ATLARGE then
		
		iFrameStart = thisOffset + 2558
		iFrameEnd   = thisOffset + 2878
		
	elseif panel[STAGE_HARRY] == ATLARGE and panel[STAGE_DAN] > ATLARGE and panel[STAGE_LOCO] == ATLARGE and panel[STAGE_CACTUS] > ATLARGE then
		
		iFrameStart = thisOffset + 2878
		iFrameEnd   = thisOffset + 3198
		
	end
		
	if panel[STAGE_HARRY] == ATLARGE and panel[STAGE_DAN] == ATLARGE and panel[STAGE_LOCO] > ATLARGE and panel[STAGE_CACTUS] > ATLARGE then
		
		iFrameStart = thisOffset + 3198
		iFrameEnd   = thisOffset + 3518
		
	elseif panel[STAGE_HARRY] > ATLARGE and panel[STAGE_DAN] > ATLARGE and panel[STAGE_LOCO] > ATLARGE and panel[STAGE_CACTUS] == ATLARGE then
		
		iFrameStart = thisOffset + 3518
		iFrameEnd   = thisOffset + 3838
		
	elseif panel[STAGE_HARRY] == ATLARGE and panel[STAGE_DAN] > ATLARGE and panel[STAGE_LOCO] > ATLARGE and panel[STAGE_CACTUS] > ATLARGE then
		
		iFrameStart = thisOffset + 3838
		iFrameEnd   = thisOffset + 4160
		
	elseif panel[STAGE_HARRY] > ATLARGE and panel[STAGE_DAN] > ATLARGE and panel[STAGE_LOCO] == ATLARGE and panel[STAGE_CACTUS] > ATLARGE then
		
		iFrameStart = thisOffset + 4160
		iFrameEnd   = thisOffset + 4478
		
	elseif panel[STAGE_HARRY] > ATLARGE and panel[STAGE_DAN] == ATLARGE and panel[STAGE_LOCO] > ATLARGE and panel[STAGE_CACTUS] > ATLARGE then
		
		iFrameStart = thisOffset + 4478
		iFrameEnd   = thisOffset + 4798
		
	end
	
	if bDebug then debugPrint ("Leaving doMenuSelectClip2()") end
	
end

function initJob()

	readConfig()
	iCoins = 0
	blinkSecs = os.clock()
	lastBlinkSecs = blinkSecs
	bShowMouse = false
	bShowScore = false
	bShowCredits = true
	bShowdown = false
	
	sprCursor = nil
	if (dip_Crosshair == 1) then

		sprCursor  = spriteLoad("singe/lbh/crosshaira.png")
		cursoroffsetx = 3; cursoroffsety = 3
		
	elseif (dip_Crosshair == 2) then
	
		sprCursor  = spriteLoad("singe/lbh/crosshairb.png")
		cursoroffsetx = 6; cursoroffsety = 6
		
	elseif (dip_Crosshair == 3) then
	
		sprCursor  = spriteLoad("singe/lbh/crosshairc.png")
		cursoroffsetx = 0; cursoroffsety = 0
		
	elseif (dip_Crosshair == 4) then
	
		sprCursor  = spriteLoad("singe/lbh/crosshaird.png")
		cursoroffsetx = 6; cursoroffsety = 6
		
	elseif (dip_Crosshair == 5) then
	
		sprCursor  = spriteLoad("singe/lbh/crosshaire.png")
		cursoroffsetx = 0; cursoroffsety = 0
		
	end

	if (dip_Difficulty == DOPT_EASY) then
	
		iDelay = 0.8
		SCORE_BADGUY = 100
		
	
	elseif (dip_Difficulty == DOPT_MEDIUM) then
		
		iDelay = 0.6		
		SCORE_BADGUY = 200
		
		
	elseif (dip_Difficulty == DOPT_HARD) then
	
		iDelay = 0.3
		SCORE_BADGUY = 250
		
		
	elseif (dip_Difficulty == DOPT_EXTREME) then
	
		iDelay = 0.150
		SCORE_BADGUY = 300
		
	
	end
	
	tx=0;ty=x;sx=0;sy=0;crx=0;cry=0
	colorForeground(255, 0, 0)
	fontSelect(fontCA16pt)
	sprCredits = nil
	sprCredits = fontToSprite(string.format('CREDITS: %d',iCredits))
	
	tx = (overlayGetWidth()  * 0.5) - (spriteGetWidth(sprCredits) * 0.5)
	ty = (overlayGetHeight() * 0.85) - (spriteGetHeight(sprCredits) * 0.5)	
	
	sprFreePlay = nil
	sprFreePlay = fontToSprite(string.format('FREE PLAY'))
	crx = (overlayGetWidth()  * 0.5) - (spriteGetWidth(sprFreePlay) * 0.5)
	cry = (overlayGetHeight() * 0.85) - (spriteGetHeight(sprFreePlay) * 0.5)
	
	fontSelect(fontCA16pt)
	sprScore = nil
	sprScore = fontToSprite(string.format('00000'))	
	
	sx = ((overlayGetWidth()  * 0.5) - (spriteGetWidth(sprScore) * 0.5))
	sy = ((overlayGetHeight() * 0.9) - (spriteGetHeight(sprScore) * 0.5))	
	scrx= nil; scrx = {sx, sx + 14, sx + (14*2), sx + (14*3), sx + 14*4}
	
	colorForeground(0, 0, 255)
	sprHSTitle = nil
	sprHSTitle = fontToSprite(string.format('TOP HUNTERS'))
	colorForeground(0, 255, 0)	
	
	hsx = ((overlayGetWidth()  * 0.5) - (spriteGetWidth(sprHSTitle) * 0.5))
	hsy = 20 
	rndegg = random.new(os.clock() * 100000)
	

end

function initVLDP()

	if (lvlState == lvlSetup) then
	
		if bDebug then debugPrint("Entering initVLDP()" .. offsetMenus) end
	
		playMe(sndCoin)		
		discSkipToFrame (offsetMenus)
		lvlState = lvlRunning
		
		bShowMouse = false
		bReloadDisabled = true		
		bPlaySound = false
		bShowScore = false
	
	elseif (lvlState == lvlRunning) then
		
		if currentFrame == (offsetMenus + 85) then
		
			discPause()
			lvlState = lvlEnd
		
		end
	
	elseif (lvlState == lvlEnd) then	
		
		lvlState = lvlSetup
		gameflow = stateStartup
		
		if bDebug then debugPrint("Leaving initVLDP()") end
	
	end

end

function getNags(thisType)

	if bDebug then debugPrint("Entering getNags()") end
	
	local q = 0
	local w = 0
	local b1 = true
	
	iLives = iLives - 1
	
	if dip_Undertaker then
	
		if iLives == 0 then
		
			nagFrameStart = 16670
			nagFrameEnd   = 16784
		
		elseif thisType == NAG_FRIENDLYKILLED then
			
			if civ[1] and civ[2] and civ[3] then
			
				civ[1] = false
				civ[2] = false
				civ[3] = false
				--civ[4] = false
			
			end
			
			b1 = true
			while b1 do
			
				--q, w = math.modf(clockRnd()/3)				
				q = rndegg:value(0,3)
				
				if q >= 0 and q < 4 then
				
					if civ[q] == false then
						civ[q] = true
						b1 = false
					end
					
				end			
			
			end

			if q == 0 then
			
				nagFrameStart = 16785
				nagFrameEnd = 16945
			
			elseif q == 1 then
		
				nagFrameStart = 16946
				nagFrameEnd = 17129
				
			elseif q == 2 then
		
				nagFrameStart = 17130
				nagFrameEnd = 17212
				
			elseif q == 3 then
		
				nagFrameStart = 17213
				nagFrameEnd = 17314
			
			end
			
		
		elseif thisType == NAG_NORMAL then
			
			if nag[1] and nag[2] and nag[3] and nag[4] and nag[5] and nag[6] and nag[7] and nag[8] then
			
				nag[1] = false
				nag[2] = false
				nag[3] = false				
				nag[4] = false				
				nag[5] = false				
				nag[6] = false				
				nag[7] = false				
				nag[8] = false				
			
			end
		
			b1 = true
				
			while b1 do
			
				--q = clockRnd()
				q = rndegg:value(1,8)
				
				if q > 0 and q < 9 then
				
					if nag[q] == false then
						nag[q] = true
						b1 = false
					end
					
				end
				
			end
			
			if q == 1 then
		
				nagFrameStart = 15666
				nagFrameEnd = 15777
				
			elseif q == 2 then
		
				nagFrameStart = 15778
				nagFrameEnd = 15900
				
			elseif q == 3 then
		
				nagFrameStart = 15901
				nagFrameEnd = 15991
			
			elseif q == 4 then
		
				nagFrameStart = 15992
				nagFrameEnd = 16104
				
			elseif q == 5 then
		
				nagFrameStart = 16105
				nagFrameEnd = 16222
				
			elseif q == 6 then
		
				nagFrameStart = 16223
				nagFrameEnd = 16360
				
			elseif q == 7 then
		
				nagFrameStart = 16361
				nagFrameEnd = 16498
			
			elseif q == 8 then
		
				nagFrameStart = 16499
				nagFrameEnd =  16669
				
			end
			
			
		end
	
	else
		
		nagFrameStart = 0
		nagFrameEnd =  2
		
	end
	

	
	if bDebug then debugPrint("Leaving getNags()") end

end

function onInputPressed(intWhat)
	
	
	if not bPause then
	
		if (intWhat == SWITCH_BUTTON3) then

			p1BUTTON3 = true
			
		elseif (intWhat == SWITCH_BUTTON1) then

			p1BUTTON1 = true
			
		elseif (intWhat == SWITCH_SERVICE) then
			
			p1SERVICE = true
			
		elseif (intWhat == SWITCH_START1) then
			
			p1START1 = true
		
		elseif (intWhat == SWITCH_COIN1) then
			
			p1COIN1 = true
			
		elseif (intWhat == SWITCH_COIN2) then
			
			p1COIN2 = true
			
		end
		
	end
	
	return true



end

function onInputReleased(intWhat)

	if (intWhat == SWITCH_PAUSE) then 			
		
		bPause = not bPause 
		if not (currentLevel == levelIntro or currentLevel == levelService) then bShowMouse = not bPause end		
		
	elseif (intWhat == SWITCH_QUIT) then	-- if user pressed ESC then quit program.
			gameflow = stateQuit
			
	elseif (bPause == false) and (currentLevel ~= levelInit) then
			
		if (intWhat == SWITCH_START1) then
		
			-- If user presses 1up on their cab then start a new game.	
			p1START1 = false
			
			if (currentLevel == levelIntro) then
			
				if (iCredits > 0 or dip_CoinsPerCredit == DOPT_FREEPLAY) then 
			
					iBullets = dip_MaxBullets
					iCredits = iCredits - 1				
					iScore = 0
					iLives = dip_LivesPerCredit
					currentLevel = levelArmybase
					tempLevel = currentLevel
					lvlState = lvlSetup					
					bLevelComplete = false
					bPlaySound = true
					bReloadDisabled = false
					bSection01Reached = false
					bSection02Reached = false
					bSection03Reached = false
					bAdviceGiven = false
					bResetContinue = false
					bHarryAlt = false
					bLocoAlt = false
					bShowMouse = true				
					bShowScore = true
					bShowCredits = false
					bJustStarting = true
					bShowdown = false
					rndegg = random.new(os.clock() * 100000)
					
					stage = nil; stage = {false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false}
					panel = nil; panel = {ATLARGE, ATLARGE, ATLARGE, ATLARGE}
				
				end
				
			end
			
		elseif (intWhat == SWITCH_BUTTON3) then	
			
			p1BUTTON3 = false
			
			if (iBullets > 0 and not (currentLevel == levelMenu or currentLevel == levelIntro or currentLevel == levelService)) then
			
				iBullets = iBullets - 1
				if dip_Crosshair == 5 then blinkRev() end
				playMe(sndGunshot)
			
			else
			
				if not (currentLevel == levelIntro or currentLevel == levelService or currentLevel == levelContinue or currentLevel == levelGameOver or currentLevel == levelLivesLeft) then playMe(sndEmpty) end
			
			end
			
		elseif (intWhat == SWITCH_BUTTON1) then
		
			p1BUTTON1 = false
			
			if (bReloadDisabled == false) then
			
				if(dip_ReloadTrigger == DOPT_ONEMPTY) then
				
					if (iBullets == 0) then 
						iBullets = dip_MaxBullets 
						playMe(sndReload)
					end
				
				elseif(dip_ReloadTrigger == DOPT_IMMEDIATE) then
				
					if (iBullets < dip_MaxBullets) then	-- Reload if there is less than max (avoid emptying bonus bullets)
						iBullets = dip_MaxBullets
						playMe(sndReload)
					end
					
				elseif(dip_ReloadTrigger == DOPT_BORDERS) then
				
					if (mousex <= 10 or mousex >= 350) or (mousey <= 10 or mousey >= 230) then
					
						if (iBullets <= dip_MaxBullets) then	-- Reload is there is less than max (avoid emptying bonus bullets)
							iBullets = dip_MaxBullets
							playMe(sndReload)
						
						end
					
					end
				
				end
				
			else
			
				if not (currentLevel == levelIntro or currentLevel == levelService) then playMe(sndEmpty) end
				
			end
			
		elseif (intWhat == SWITCH_SERVICE) then
		
			p1SERVICE = false
			
			if not (currentLevel == levelService or gameflow == stateVLDPwake) then
			
				lvlState = lvlSetup
				currentLevel = levelService		
				
			end
			
		elseif (intWhat == SWITCH_COIN1 or intWhat == SWITCH_COIN2) then

			p1COIN1 = false
			p1COIN2 = false
			
			if not (dip_CoinsPerCredit == DOPT_FREEPLAY) then
			
				if (iCredits < 9) then
				
					iCoins = iCoins + 1			
					
					if (iCoins >= dip_CoinsPerCredit) then
					
						iCoins = iCoins - dip_CoinsPerCredit
						iCredits = iCredits + 1
						playMe(sndCredit)
						
					else
					
						playMe(sndCoin)					
					
					end
					if currentLevel == levelContinue then bResetContinue = true end
				
				end
				
			end
			
		end
		
	end
	
	return true
	
end

function onMouseMoved(intX, intY, intXrel, intYrel)

	mousex = intX
	mousey = intY
	cursorx = intX - cursoroffsetx
	cursory = intY - cursoroffsety
	revsetx = intX - 3
	revsety = intY - 3

end

function onOverlayUpdate()

	overlayClear()
	
	currentFrame = discGetFrame()
	
	if (gameflow == stateVLDPwake) then

		initVLDP()
	
	elseif (gameflow == stateStartup) then
	
		debugPrint ("Playing CDROM version " .. sVersion)			
		
		initJob()		
		gameflow = statePlaying
		currentLevel = levelIntro
		lvlState = lvlSetup	
		
	elseif (gameflow == statePlaying) then	
	
		if (currentLevel == levelService) then
		
			doServiceMenu()
			
		elseif (bShowdown == true and dip_Showdown == true) then
		
			doLevelShowdown()
			
		elseif (currentLevel == levelBonus) then
		
			doLevelBonus()			
			
		elseif (currentLevel == levelIntro) then
			
			doIntro()
			
		elseif (currentLevel == levelMenu) then
		
			doMenu()
			
		elseif (currentLevel == levelArmybase) then
		
			doLevelArmybase()
			
		elseif (currentLevel == levelCactus1) then
		
			doLevelCactus1()
			
		elseif (currentLevel == levelCactus2) then
		
			doLevelCactus2()
			
		elseif (currentLevel == levelCactus3) then
		
			doLevelCactus3()
			
		elseif (currentLevel == levelCactus4) then
		
			doLevelCactus4()
			
		elseif (currentLevel == levelCactus5) then
		
			doLevelCactus5()
			
		elseif (currentLevel == levelCactus6) then
		
			doLevelCactus6()
			
		elseif (currentLevel == levelDan1) then
		
			doLevelDan1()
			
		elseif (currentLevel == levelDan2) then
		
			doLevelDan2()
			
		elseif (currentLevel == levelDan3) then
		
			doLevelDan3()
			
		elseif (currentLevel == levelHarry1) then
		
			doLevelHarry1()
			
		elseif (currentLevel == levelHarry2) then
		
			doLevelHarry2()
			
		elseif (currentLevel == levelHarry3) then
		
			doLevelHarry3()
			
		elseif (currentLevel == levelHarry4) then
		
			doLevelHarry4()
			
		elseif (currentLevel == levelLoco1) then
		
			doLevelLoco1()
			
		elseif (currentLevel == levelLoco2) then
		
			doLevelLoco2()
			
		elseif (currentLevel == levelLoco3) then
		
			doLevelLoco3()
			
		elseif (currentLevel == levelLoco4) then
		
			doLevelLoco4()
		
		elseif (currentLevel == levelFinal1) then
		
			doLevelFinal1()
			
		elseif (currentLevel == levelFinal2) then
		
			doLevelFinal2()
		
		elseif (currentLevel == levelContinue) then
		
			doContinue()
			
		elseif (currentLevel == levelGameOver) then
		
			doGameOver()
			
		elseif (currentLevel == levelLivesLeft) then
		
			doLivesLeft()
			
		elseif (currentLevel == levelHighScore) then
		
			doHighScore()
		
		end	
	
	end
	
	if (bShowMouse) then 
	
		spriteDraw(cursorx, cursory, sprCursor) 
		
		if (bReversePointer and not (currentLevel == levelHighScore)) then 
		
			iRevFrames = iRevFrames + 1
			if (iRevFrames == REV_DELAY) then
			
				bReversePointer = false
			else
				spriteDraw(revsetx, revsety, sprRev) 
				
			end
			
		end	
	
	end
	
	if (bShowScore) then
		
		drawBullets()		
		drawLives()		
		drawSpriteScore()
	
	elseif bShowCredits then
	
		drawCredits()
	
	end
		
	if bDebug then showDebugInfo() end
	
	return(OVERLAY_UPDATED)
	
end

function onSoundCompleted(intWhich)

	-- leave empty
	
end

function onShutdown()
	
	discStop()
	
	if (bDebug == true) then debugPrint ("Leaving game!") end
	
end

function playMe(thisSound)

	if (bPlaySound == true) then
	
		if (bDebug) then debugPrint ("Playing sound") end
		soundPlay(thisSound)
		
		return true
		
	else
	
		return false
		
	end
	
end

function showDebugInfo()

end
